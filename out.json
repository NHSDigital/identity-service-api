============================= test session starts ==============================
platform linux -- Python 3.9.5, pytest-6.2.5, py-1.10.0, pluggy-1.0.0 -- /home/jf/Work/NHSDigital/identity-service-api/.venv/bin/python
cachedir: .pytest_cache
rootdir: /home/jf/Work/NHSDigital/identity-service-api/e2e, configfile: pytest.ini
plugins: forked-1.3.0, xdist-2.4.0, sugar-0.9.4, asyncio-0.14.0, rerunfailures-10.2
collecting ... collected 12 items / 11 deselected / 1 selected

e2e/tests/oauth/test_backchannel_logout.py::TestBackChannelLogout::test_backchannel_logout_happy_path 
Creating Default App..
{"completed": true, "point": [{"id": "Paused", "results": []}, {"id": "Resumed", "results": []}, {"id": "StateChange", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "To", "value": "REQ_HEADERS_PARSED"}, {"name": "From", "value": "REQ_START"}]}, "timestamp": "03-11-21 16:50:06:976"}, {"ActionResult": "RequestMessage", "headers": [{"name": "Accept", "value": "*/*"}, {"name": "Accept-Encoding", "value": "gzip,deflate"}, {"name": "Authorization", "value": "*****"}, {"name": "Host", "value": "internal-dev.api.service.nhs.uk"}, {"name": "User-Agent", "value": "Python/3.9 aiohttp/3.7.4.post0"}, {"name": "X-Apigee.client.connection", "value": "3.11.106.35:54762;35.234.138.138:443;ssl"}, {"name": "X-Apigee.Host", "value": "internal-dev.api.service.nhs.uk:443"}, {"name": "X-Apigee.Message-ID", "value": "rrt-4658976038220403375-a-geu2-24021-103322-1"}, {"name": "X-Apigee.Message-Timeout", "value": "57"}, {"name": "X-Forwarded-For", "value": "3.11.106.35"}, {"name": "X-Forwarded-Port", "value": "443"}, {"name": "X-Forwarded-Proto", "value": "https"}], "uRI": "/oauth2-pr-251/userinfo", "verb": "GET"}]}, {"id": "FlowInfo", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "environment.name", "value": "internal-dev"}, {"name": "environment.qualifiedname", "value": "nhsd-nonprod__internal-dev"}, {"name": "environment.orgname", "value": "nhsd-nonprod"}]}, "timestamp": "03-11-21 16:50:06:976"}]}, {"id": "FlowInfo", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "organization.name", "value": "nhsd-nonprod"}]}, "timestamp": "03-11-21 16:50:06:976"}]}, {"id": "FlowInfo", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "apiproxy.qualifiedname", "value": "identity-service-pr-251__13"}, {"name": "apiproxy.basepath", "value": "/"}, {"name": "apiproxy.revision", "value": "13"}, {"name": "apiproxy.name", "value": "identity-service-pr-251"}]}, "timestamp": "03-11-21 16:50:06:976"}]}, {"id": "FlowInfo", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "proxy.basepath", "value": "oauth2-pr-251"}, {"name": "proxy.pathsuffix", "value": "/userinfo"}, {"name": "proxy.url", "value": "https://internal-dev.api.service.nhs.uk/oauth2-pr-251/userinfo"}, {"name": "proxy.name", "value": "default"}, {"name": "proxy.client.ip", "value": "3.11.106.35"}]}, "timestamp": "03-11-21 16:50:06:976"}]}, {"id": "FlowInfo", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "virtualhost.aliases.values", "value": "[\"nhsd-nonprod-internal-dev.apigee.net\",\"internal-dev.api.service.nhs.uk\"]"}, {"name": "virtualhost.port", "value": "443"}, {"name": "virtualhost.name", "value": "secure"}, {"name": "virtualhost.ssl.enabled", "value": "true"}, {"name": "virtualhost.aliases", "value": "{nhsd-nonprod-internal-dev.apigee.net,internal-dev.api.service.nhs.uk}"}, {"name": "virtualhost.ip", "value": "35.234.138.138"}]}, "timestamp": "03-11-21 16:50:06:976"}]}, {"id": "FlowInfo", "results": [{"ActionResult": "DebugInfo", "properties": {"property": []}, "timestamp": "03-11-21 16:50:06:976"}]}, {"id": "StateChange", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "To", "value": "PROXY_REQ_FLOW"}, {"name": "From", "value": "REQ_HEADERS_PARSED"}]}, "timestamp": "03-11-21 16:50:06:976"}, {"ActionResult": "RequestMessage", "headers": [{"name": "Accept", "value": "*/*"}, {"name": "Accept-Encoding", "value": "gzip,deflate"}, {"name": "Authorization", "value": "*****"}, {"name": "Host", "value": "internal-dev.api.service.nhs.uk"}, {"name": "User-Agent", "value": "Python/3.9 aiohttp/3.7.4.post0"}, {"name": "X-Forwarded-For", "value": "3.11.106.35"}, {"name": "X-Forwarded-Port", "value": "443"}, {"name": "X-Forwarded-Proto", "value": "https"}], "uRI": "/oauth2-pr-251/userinfo", "verb": "GET"}]}, {"id": "Execution", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "type", "value": "FlowHookAction"}]}, "timestamp": "03-11-21 16:50:06:977"}, {"ActionResult": "RequestMessage", "headers": [{"name": "Accept", "value": "*/*"}, {"name": "Accept-Encoding", "value": "gzip,deflate"}, {"name": "Authorization", "value": "*****"}, {"name": "Host", "value": "internal-dev.api.service.nhs.uk"}, {"name": "User-Agent", "value": "Python/3.9 aiohttp/3.7.4.post0"}, {"name": "X-Forwarded-For", "value": "3.11.106.35"}, {"name": "X-Forwarded-Port", "value": "443"}, {"name": "X-Forwarded-Proto", "value": "https"}], "uRI": "/oauth2-pr-251/userinfo", "verb": "GET"}, {"ActionResult": "VariableAccess", "accessList": []}]}, {"id": "FlowCallout", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "shared.flow.name", "value": "PreProxyFlowHook->PreProxySharedFlow"}]}, "timestamp": "03-11-21 16:50:06:977"}]}, {"id": "Paused", "results": []}, {"id": "Execution", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "action", "value": "CONTINUE"}, {"name": "stepDefinition-async", "value": "false"}, {"name": "internal", "value": "false"}, {"name": "stepDefinition-type", "value": "keyvaluemapoperations"}, {"name": "type", "value": "KeyValueMapOperationsExecution"}, {"name": "enforcement", "value": "request"}, {"name": "stepDefinition-continueOnError", "value": "false"}, {"name": "stepDefinition-displayName", "value": "KeyValueMapOperations.GetCommonSecrets"}, {"name": "stepDefinition-name", "value": "KeyValueMapOperations.GetCommonSecrets"}, {"name": "stepDefinition-enabled", "value": "true"}, {"name": "result", "value": "true"}]}, "timestamp": "03-11-21 16:50:06:977"}, {"ActionResult": "RequestMessage", "headers": [{"name": "Accept", "value": "*/*"}, {"name": "Accept-Encoding", "value": "gzip,deflate"}, {"name": "Authorization", "value": "*****"}, {"name": "Host", "value": "internal-dev.api.service.nhs.uk"}, {"name": "User-Agent", "value": "Python/3.9 aiohttp/3.7.4.post0"}, {"name": "X-Forwarded-For", "value": "3.11.106.35"}, {"name": "X-Forwarded-Port", "value": "443"}, {"name": "X-Forwarded-Proto", "value": "https"}], "uRI": "/oauth2-pr-251/userinfo", "verb": "GET"}, {"ActionResult": "VariableAccess", "accessList": [{"Get": {"name": "current.flow"}}, {"Set": {"name": "apigee.metrics.policy.KeyValueMapOperations.GetCommonSecrets.timeTaken", "success": true, "value": "46496"}}]}]}, {"id": "Resumed", "results": []}, {"id": "Paused", "results": []}, {"id": "Execution", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "action", "value": "CONTINUE"}, {"name": "stepDefinition-async", "value": "false"}, {"name": "internal", "value": "false"}, {"name": "stepDefinition-type", "value": "keyvaluemapoperations"}, {"name": "type", "value": "KeyValueMapOperationsExecution"}, {"name": "enforcement", "value": "request"}, {"name": "stepDefinition-continueOnError", "value": "false"}, {"name": "stepDefinition-displayName", "value": "KeyValueMapOperations.GetConfigClear"}, {"name": "stepDefinition-name", "value": "KeyValueMapOperations.GetConfigClear"}, {"name": "stepDefinition-enabled", "value": "true"}, {"name": "result", "value": "true"}]}, "timestamp": "03-11-21 16:50:06:977"}, {"ActionResult": "RequestMessage", "headers": [{"name": "Accept", "value": "*/*"}, {"name": "Accept-Encoding", "value": "gzip,deflate"}, {"name": "Authorization", "value": "*****"}, {"name": "Host", "value": "internal-dev.api.service.nhs.uk"}, {"name": "User-Agent", "value": "Python/3.9 aiohttp/3.7.4.post0"}, {"name": "X-Forwarded-For", "value": "3.11.106.35"}, {"name": "X-Forwarded-Port", "value": "443"}, {"name": "X-Forwarded-Proto", "value": "https"}], "uRI": "/oauth2-pr-251/userinfo", "verb": "GET"}, {"ActionResult": "VariableAccess", "accessList": [{"Get": {"name": "current.flow"}}, {"Set": {"name": "apim.feature_toggles_raw", "success": true, "value": "{\"enable-token-exchange\": true, \"enable-nhs-login-combined-auth\": true, \"enable-citizen-access\": true}"}}, {"Set": {"name": "apigee.metrics.policy.KeyValueMapOperations.GetConfigClear.timeTaken", "success": true, "value": "18570"}}]}]}, {"id": "Resumed", "results": []}, {"id": "Paused", "results": []}, {"id": "Execution", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "action", "value": "CONTINUE"}, {"name": "stepDefinition-async", "value": "false"}, {"name": "internal", "value": "false"}, {"name": "stepDefinition-type", "value": "keyvaluemapoperations"}, {"name": "type", "value": "KeyValueMapOperationsExecution"}, {"name": "enforcement", "value": "request"}, {"name": "stepDefinition-continueOnError", "value": "false"}, {"name": "stepDefinition-displayName", "value": "KeyValueMapOperations.GetConfigEncrypted"}, {"name": "stepDefinition-name", "value": "KeyValueMapOperations.GetConfigEncrypted"}, {"name": "stepDefinition-enabled", "value": "true"}, {"name": "result", "value": "true"}]}, "timestamp": "03-11-21 16:50:06:977"}, {"ActionResult": "RequestMessage", "headers": [{"name": "Accept", "value": "*/*"}, {"name": "Accept-Encoding", "value": "gzip,deflate"}, {"name": "Authorization", "value": "*****"}, {"name": "Host", "value": "internal-dev.api.service.nhs.uk"}, {"name": "User-Agent", "value": "Python/3.9 aiohttp/3.7.4.post0"}, {"name": "X-Forwarded-For", "value": "3.11.106.35"}, {"name": "X-Forwarded-Port", "value": "443"}, {"name": "X-Forwarded-Proto", "value": "https"}], "uRI": "/oauth2-pr-251/userinfo", "verb": "GET"}, {"ActionResult": "VariableAccess", "accessList": [{"Get": {"name": "current.flow"}}, {"Set": {"name": "apigee.metrics.policy.KeyValueMapOperations.GetConfigEncrypted.timeTaken", "success": true, "value": "20152"}}]}]}, {"id": "Resumed", "results": []}, {"id": "Paused", "results": []}, {"id": "Execution", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "javascript-executionTime", "value": "0"}, {"name": "action", "value": "CONTINUE"}, {"name": "javascript-timeLimit", "value": "200"}, {"name": "stepDefinition-async", "value": "false"}, {"name": "internal", "value": "false"}, {"name": "stepDefinition-type", "value": "javascript"}, {"name": "javascript-name", "value": "UnpackVars.js"}, {"name": "type", "value": "JavascriptStepExecution"}, {"name": "enforcement", "value": "request"}, {"name": "stepDefinition-continueOnError", "value": "false"}, {"name": "stepDefinition-displayName", "value": "Javascript.UnpackVars"}, {"name": "stepDefinition-name", "value": "Javascript.UnpackVars"}, {"name": "stepDefinition-enabled", "value": "true"}, {"name": "result", "value": "true"}]}, "timestamp": "03-11-21 16:50:06:977"}, {"ActionResult": "RequestMessage", "headers": [{"name": "Accept", "value": "*/*"}, {"name": "Accept-Encoding", "value": "gzip,deflate"}, {"name": "Authorization", "value": "*****"}, {"name": "Host", "value": "internal-dev.api.service.nhs.uk"}, {"name": "User-Agent", "value": "Python/3.9 aiohttp/3.7.4.post0"}, {"name": "X-Forwarded-For", "value": "3.11.106.35"}, {"name": "X-Forwarded-Port", "value": "443"}, {"name": "X-Forwarded-Proto", "value": "https"}], "uRI": "/oauth2-pr-251/userinfo", "verb": "GET"}, {"ActionResult": "VariableAccess", "accessList": [{"Get": {"name": "current.flow"}}, {"Get": {"name": "apim.vars_raw"}}, {"Get": {"name": "apim.feature_toggles_raw", "value": "{\"enable-token-exchange\": true, \"enable-nhs-login-combined-auth\": true, \"enable-citizen-access\": true}"}}, {"Set": {"name": "apim.feature_toggles.enable-token-exchange", "success": true, "value": "true"}}, {"Set": {"name": "apim.feature_toggles.enable-nhs-login-combined-auth", "success": true, "value": "true"}}, {"Set": {"name": "apim.feature_toggles.enable-citizen-access", "success": true, "value": "true"}}, {"Set": {"name": "apigee.metrics.policy.Javascript.UnpackVars.timeTaken", "success": true, "value": "188756"}}]}]}, {"id": "Resumed", "results": []}, {"id": "Execution", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "action", "value": "CONTINUE"}, {"name": "stepDefinition-async", "value": "false"}, {"name": "internal", "value": "false"}, {"name": "stepDefinition-type", "value": "assignmessage"}, {"name": "type", "value": "AssignMessageExecution"}, {"name": "enforcement", "value": "request"}, {"name": "stepDefinition-continueOnError", "value": "false"}, {"name": "stepDefinition-displayName", "value": "AssignMessage.Copy.RequestDataForSplunk"}, {"name": "stepDefinition-name", "value": "AssignMessage.Copy.RequestDataForSplunk"}, {"name": "stepDefinition-enabled", "value": "true"}, {"name": "result", "value": "true"}]}, "timestamp": "03-11-21 16:50:06:978"}, {"ActionResult": "RequestMessage", "headers": [{"name": "Accept", "value": "*/*"}, {"name": "Accept-Encoding", "value": "gzip,deflate"}, {"name": "Authorization", "value": "*****"}, {"name": "Host", "value": "internal-dev.api.service.nhs.uk"}, {"name": "User-Agent", "value": "Python/3.9 aiohttp/3.7.4.post0"}, {"name": "X-Forwarded-For", "value": "3.11.106.35"}, {"name": "X-Forwarded-Port", "value": "443"}, {"name": "X-Forwarded-Proto", "value": "https"}], "uRI": "/oauth2-pr-251/userinfo", "verb": "GET"}, {"ActionResult": "VariableAccess", "accessList": [{"Get": {"name": "current.flow"}}, {"Get": {"name": "request.uri", "value": "/oauth2-pr-251/userinfo"}}, {"Set": {"name": "request-data-for-splunk.uri", "success": true, "value": "/oauth2-pr-251/userinfo"}}, {"Get": {"name": "request.url"}}, {"Set": {"name": "request-data-for-splunk.url", "success": true, "value": ""}}, {"Set": {"name": "apigee.metrics.policy.AssignMessage.Copy.RequestDataForSplunk.timeTaken", "success": true, "value": "31269"}}]}]}, {"id": "Execution", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "action", "value": "CONTINUE"}, {"name": "stepDefinition-async", "value": "false"}, {"name": "internal", "value": "false"}, {"name": "stepDefinition-type", "value": "assignmessage"}, {"name": "type", "value": "AssignMessageExecution"}, {"name": "enforcement", "value": "request"}, {"name": "stepDefinition-continueOnError", "value": "false"}, {"name": "stepDefinition-displayName", "value": "AssignMessage.Copy.RequestHeaders"}, {"name": "stepDefinition-name", "value": "AssignMessage.Copy.RequestHeaders"}, {"name": "stepDefinition-enabled", "value": "true"}, {"name": "result", "value": "true"}]}, "timestamp": "03-11-21 16:50:06:978"}, {"ActionResult": "RequestMessage", "headers": [{"name": "Accept", "value": "*/*"}, {"name": "Accept-Encoding", "value": "gzip,deflate"}, {"name": "Authorization", "value": "*****"}, {"name": "Host", "value": "internal-dev.api.service.nhs.uk"}, {"name": "User-Agent", "value": "Python/3.9 aiohttp/3.7.4.post0"}, {"name": "X-Forwarded-For", "value": "3.11.106.35"}, {"name": "X-Forwarded-Port", "value": "443"}, {"name": "X-Forwarded-Proto", "value": "https"}], "uRI": "/oauth2-pr-251/userinfo", "verb": "GET"}, {"ActionResult": "VariableAccess", "accessList": [{"Get": {"name": "current.flow"}}, {"Get": {"name": "original-request-details"}}, {"Set": {"name": "apigee.metrics.policy.AssignMessage.Copy.RequestHeaders.timeTaken", "success": true, "value": "6223"}}]}]}, {"id": "Execution", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "action", "value": "CONTINUE"}, {"name": "stepDefinition-async", "value": "false"}, {"name": "internal", "value": "false"}, {"name": "stepDefinition-type", "value": "assignmessage"}, {"name": "type", "value": "AssignMessageExecution"}, {"name": "enforcement", "value": "request"}, {"name": "stepDefinition-continueOnError", "value": "false"}, {"name": "stepDefinition-displayName", "value": "AssignMessage.Set.NHSDCorrelationIDHeader"}, {"name": "stepDefinition-name", "value": "AssignMessage.Set.NHSDCorrelationIDHeader"}, {"name": "stepDefinition-enabled", "value": "true"}, {"name": "result", "value": "true"}]}, "timestamp": "03-11-21 16:50:06:978"}, {"ActionResult": "RequestMessage", "headers": [{"name": "Accept", "value": "*/*"}, {"name": "Accept-Encoding", "value": "gzip,deflate"}, {"name": "Authorization", "value": "*****"}, {"name": "Host", "value": "internal-dev.api.service.nhs.uk"}, {"name": "NHSD-Correlation-ID", "value": "..rrt-4658976038220403375-a-geu2-24021-103322-1"}, {"name": "User-Agent", "value": "Python/3.9 aiohttp/3.7.4.post0"}, {"name": "X-Forwarded-For", "value": "3.11.106.35"}, {"name": "X-Forwarded-Port", "value": "443"}, {"name": "X-Forwarded-Proto", "value": "https"}], "uRI": "/oauth2-pr-251/userinfo", "verb": "GET"}, {"ActionResult": "VariableAccess", "accessList": [{"Get": {"name": "current.flow"}}, {"Get": {"name": "message.header.X-Request-ID"}}, {"Get": {"name": "message.header.X-Correlation-ID"}}, {"Get": {"name": "messageid", "value": "rrt-4658976038220403375-a-geu2-24021-103322-1"}}, {"Set": {"name": "message.header.NHSD-Correlation-ID", "success": true, "value": "..rrt-4658976038220403375-a-geu2-24021-103322-1"}}, {"Set": {"name": "apigee.metrics.policy.AssignMessage.Set.NHSDCorrelationIDHeader.timeTaken", "success": true, "value": "11182"}}]}]}, {"id": "Execution", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "action", "value": "CONTINUE"}, {"name": "stepDefinition-async", "value": "false"}, {"name": "internal", "value": "false"}, {"name": "stepDefinition-type", "value": "assignmessage"}, {"name": "type", "value": "AssignMessageExecution"}, {"name": "enforcement", "value": "request"}, {"name": "stepDefinition-continueOnError", "value": "false"}, {"name": "stepDefinition-displayName", "value": "AssignMessage.Set.NHSDRequestIDHeader"}, {"name": "stepDefinition-name", "value": "AssignMessage.Set.NHSDRequestIDHeader"}, {"name": "stepDefinition-enabled", "value": "true"}, {"name": "result", "value": "true"}]}, "timestamp": "03-11-21 16:50:06:978"}, {"ActionResult": "RequestMessage", "headers": [{"name": "Accept", "value": "*/*"}, {"name": "Accept-Encoding", "value": "gzip,deflate"}, {"name": "Authorization", "value": "*****"}, {"name": "Host", "value": "internal-dev.api.service.nhs.uk"}, {"name": "NHSD-Correlation-ID", "value": "..rrt-4658976038220403375-a-geu2-24021-103322-1"}, {"name": "NHSD-Request-ID", "value": ""}, {"name": "User-Agent", "value": "Python/3.9 aiohttp/3.7.4.post0"}, {"name": "X-Forwarded-For", "value": "3.11.106.35"}, {"name": "X-Forwarded-Port", "value": "443"}, {"name": "X-Forwarded-Proto", "value": "https"}], "uRI": "/oauth2-pr-251/userinfo", "verb": "GET"}, {"ActionResult": "VariableAccess", "accessList": [{"Get": {"name": "current.flow"}}, {"Get": {"name": "message.header.X-Request-ID"}}, {"Set": {"name": "message.header.NHSD-Request-ID", "success": true, "value": ""}}, {"Set": {"name": "apigee.metrics.policy.AssignMessage.Set.NHSDRequestIDHeader.timeTaken", "success": true, "value": "9720"}}]}]}, {"id": "FlowReturn", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "shared.flow.name", "value": "PreProxyFlowHook->PreProxySharedFlow"}]}, "timestamp": "03-11-21 16:50:06:978"}]}, {"id": "Condition", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "ExpressionResult", "value": "true"}, {"name": "Expression", "value": "(\"default\" equals proxy.name)"}, {"name": "Tree", "value": "PROXY_default"}]}, "timestamp": "03-11-21 16:50:06:978"}, {"ActionResult": "VariableAccess", "accessList": [{"Set": {"name": "apigee.edge.sharedflow.name", "success": true}}, {"Set": {"name": "apigee.edge.flowhook.name", "success": true}}, {"Get": {"name": "proxy.name", "value": "default"}}]}]}, {"id": "FlowInfo", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "proxy.flow.name", "value": "PreFlow"}]}, "timestamp": "03-11-21 16:50:06:978"}]}, {"id": "FlowInfo", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "current.flow.name", "value": "PreFlow"}]}, "timestamp": "03-11-21 16:50:06:978"}]}, {"id": "Paused", "results": []}, {"id": "Execution", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "action", "value": "CONTINUE"}, {"name": "stepDefinition-async", "value": "false"}, {"name": "internal", "value": "false"}, {"name": "stepDefinition-type", "value": "keyvaluemapoperations"}, {"name": "type", "value": "KeyValueMapOperationsExecution"}, {"name": "enforcement", "value": "request"}, {"name": "stepDefinition-continueOnError", "value": "false"}, {"name": "stepDefinition-displayName", "value": "KeyValueMapOperations.GetIdentityServiceConfig"}, {"name": "stepDefinition-name", "value": "KeyValueMapOperations.GetIdentityServiceConfig"}, {"name": "stepDefinition-enabled", "value": "true"}, {"name": "result", "value": "true"}]}, "timestamp": "03-11-21 16:50:06:978"}, {"ActionResult": "RequestMessage", "headers": [{"name": "Accept", "value": "*/*"}, {"name": "Accept-Encoding", "value": "gzip,deflate"}, {"name": "Authorization", "value": "*****"}, {"name": "Host", "value": "internal-dev.api.service.nhs.uk"}, {"name": "NHSD-Correlation-ID", "value": "..rrt-4658976038220403375-a-geu2-24021-103322-1"}, {"name": "NHSD-Request-ID", "value": ""}, {"name": "User-Agent", "value": "Python/3.9 aiohttp/3.7.4.post0"}, {"name": "X-Forwarded-For", "value": "3.11.106.35"}, {"name": "X-Forwarded-Port", "value": "443"}, {"name": "X-Forwarded-Proto", "value": "https"}], "uRI": "/oauth2-pr-251/userinfo", "verb": "GET"}, {"ActionResult": "VariableAccess", "accessList": [{"Set": {"name": "apigee.metrics.policy.KeyValueMapOperations.GetIdentityServiceConfig.timeTaken", "success": true, "value": "24332"}}]}]}, {"id": "Resumed", "results": []}, {"id": "Paused", "results": []}, {"id": "Execution", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "javascript-executionTime", "value": "0"}, {"name": "action", "value": "CONTINUE"}, {"name": "javascript-timeLimit", "value": "200"}, {"name": "stepDefinition-async", "value": "false"}, {"name": "internal", "value": "false"}, {"name": "stepDefinition-type", "value": "javascript"}, {"name": "javascript-name", "value": "UnpackVars.js"}, {"name": "type", "value": "JavascriptStepExecution"}, {"name": "enforcement", "value": "request"}, {"name": "stepDefinition-continueOnError", "value": "false"}, {"name": "stepDefinition-displayName", "value": "Javascript.UnpackVars"}, {"name": "stepDefinition-name", "value": "Javascript.UnpackVars"}, {"name": "stepDefinition-enabled", "value": "true"}, {"name": "result", "value": "true"}]}, "timestamp": "03-11-21 16:50:06:978"}, {"ActionResult": "RequestMessage", "headers": [{"name": "Accept", "value": "*/*"}, {"name": "Accept-Encoding", "value": "gzip,deflate"}, {"name": "Authorization", "value": "*****"}, {"name": "Host", "value": "internal-dev.api.service.nhs.uk"}, {"name": "NHSD-Correlation-ID", "value": "..rrt-4658976038220403375-a-geu2-24021-103322-1"}, {"name": "NHSD-Request-ID", "value": ""}, {"name": "User-Agent", "value": "Python/3.9 aiohttp/3.7.4.post0"}, {"name": "X-Forwarded-For", "value": "3.11.106.35"}, {"name": "X-Forwarded-Port", "value": "443"}, {"name": "X-Forwarded-Proto", "value": "https"}], "uRI": "/oauth2-pr-251/userinfo", "verb": "GET"}, {"ActionResult": "VariableAccess", "accessList": [{"Set": {"name": "identity-service-config.cis2.access_token_expiry_ms", "success": true, "value": "600000"}}, {"Set": {"name": "identity-service-config.cis2.client_id", "success": true, "value": "test-client-1"}}, {"Set": {"name": "identity-service-config.cis2.refresh_token_expiry_ms", "success": true, "value": "3600000"}}, {"Set": {"name": "identity-service-config.cis2.refresh_tokens_validity_ms", "success": true, "value": "3600000"}}, {"Set": {"name": "identity-service-config.cis2.simulated_idp", "success": true, "value": "false"}}, {"Set": {"name": "identity-service-config.cis2.issuer", "success": true, "value": "https://identity.ptl.api.platform.nhs.uk/auth/realms/cis2-mock"}}, {"Set": {"name": "identity-service-config.cis2.access_token_path", "success": true, "value": "/auth/realms/cis2-mock/protocol/openid-connect/token"}}, {"Set": {"name": "identity-service-config.cis2.jwks_path", "success": true, "value": "/auth/realms/cis2-mock/protocol/openid-connect/certs"}}, {"Set": {"name": "identity-service-config.cis2.redirect_uri", "success": true, "value": "https://internal-dev.api.service.nhs.uk/oauth2-pr-251/callback"}}, {"Set": {"name": "identity-service-config.cis2.authorize_endpoint", "success": true, "value": "https://identity.ptl.api.platform.nhs.uk/auth/realms/cis2-mock/protocol/openid-connect/auth"}}, {"Set": {"name": "identity-service-config.cis2.userinfo_path", "success": true, "value": "/auth/realms/cis2-mock/protocol/openid-connect"}}, {"Set": {"name": "identity-service-config.cis2.backchannel_allowed_ips", "success": true, "value": "[{\"address\": \"0.0.0.0\", \"mask\": \"1\"}, {\"address\": \"128.0.0.0\", \"mask\": \"1\"}]"}}, {"Set": {"name": "identity-service-config.nhs_login.jwks_path", "success": true, "value": "/mock-nhsid-jwks/identity-service/nhs-login-jwks"}}, {"Set": {"name": "identity-service-config.nhs_login.client_id", "success": true, "value": "some-client-id"}}, {"Set": {"name": "identity-service-config.nhs_login.issuer", "success": true, "value": "https://internal-dev.api.service.nhs.uk"}}, {"Set": {"name": "identity-service-config.nhs_login.audience", "success": true, "value": "https://internal-dev.api.service.nhs.uk/mock-nhsid-jwks/nhs_login_simulated_token"}}, {"Set": {"name": "identity-service-config.nhs_login.authorize_endpoint", "success": true, "value": "https://internal-dev.api.service.nhs.uk/mock-nhsid-jwks/nhs_login_simulated_auth"}}, {"Set": {"name": "identity-service-config.nhs_login.access_token_path", "success": true, "value": "/mock-nhsid-jwks/nhs_login_simulated_token"}}, {"Set": {"name": "identity-service-config.nhs_login.kid", "success": true, "value": "test-1"}}, {"Set": {"name": "identity-service-config.nhs_login.redirect_uri", "success": true, "value": "https://internal-dev.api.service.nhs.uk/oauth2/callback"}}, {"Set": {"name": "apigee.metrics.policy.Javascript.UnpackVars.timeTaken", "success": true, "value": "250226"}}]}]}, {"id": "Resumed", "results": []}, {"id": "Execution", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "action", "value": "CONTINUE"}, {"name": "stepDefinition-async", "value": "false"}, {"name": "internal", "value": "false"}, {"name": "stepDefinition-type", "value": "assignmessage"}, {"name": "type", "value": "AssignMessageExecution"}, {"name": "enforcement", "value": "request"}, {"name": "stepDefinition-continueOnError", "value": "false"}, {"name": "stepDefinition-displayName", "value": "AssignMessage.setIDPvar"}, {"name": "stepDefinition-name", "value": "AssignMessage.setIDPvar"}, {"name": "stepDefinition-enabled", "value": "true"}, {"name": "result", "value": "true"}]}, "timestamp": "03-11-21 16:50:06:978"}, {"ActionResult": "RequestMessage", "headers": [{"name": "Accept", "value": "*/*"}, {"name": "Accept-Encoding", "value": "gzip,deflate"}, {"name": "Authorization", "value": "*****"}, {"name": "Host", "value": "internal-dev.api.service.nhs.uk"}, {"name": "NHSD-Correlation-ID", "value": "..rrt-4658976038220403375-a-geu2-24021-103322-1"}, {"name": "NHSD-Request-ID", "value": ""}, {"name": "User-Agent", "value": "Python/3.9 aiohttp/3.7.4.post0"}, {"name": "X-Forwarded-For", "value": "3.11.106.35"}, {"name": "X-Forwarded-Port", "value": "443"}, {"name": "X-Forwarded-Proto", "value": "https"}], "uRI": "/oauth2-pr-251/userinfo", "verb": "GET"}, {"ActionResult": "VariableAccess", "accessList": [{"Set": {"name": "idp", "success": true, "value": "null"}}, {"Set": {"name": "apigee.metrics.policy.AssignMessage.setIDPvar.timeTaken", "success": true, "value": "7837"}}]}]}, {"id": "Execution", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "action", "value": "CONTINUE"}, {"name": "stepDefinition-async", "value": "false"}, {"name": "internal", "value": "false"}, {"name": "stepDefinition-type", "value": "assignmessage"}, {"name": "expression", "value": "(apim.feature_toggles.enable-nhs-login-combined-auth equals true)"}, {"name": "type", "value": "AssignMessageExecution"}, {"name": "enforcement", "value": "request"}, {"name": "stepDefinition-continueOnError", "value": "false"}, {"name": "expressionResult", "value": "true"}, {"name": "stepDefinition-displayName", "value": "AssignMessage.ExtractExternalScope"}, {"name": "stepDefinition-name", "value": "AssignMessage.ExtractExternalScope"}, {"name": "stepDefinition-enabled", "value": "true"}, {"name": "result", "value": "true"}]}, "timestamp": "03-11-21 16:50:06:979"}, {"ActionResult": "RequestMessage", "headers": [{"name": "Accept", "value": "*/*"}, {"name": "Accept-Encoding", "value": "gzip,deflate"}, {"name": "Authorization", "value": "*****"}, {"name": "Host", "value": "internal-dev.api.service.nhs.uk"}, {"name": "NHSD-Correlation-ID", "value": "..rrt-4658976038220403375-a-geu2-24021-103322-1"}, {"name": "NHSD-Request-ID", "value": ""}, {"name": "User-Agent", "value": "Python/3.9 aiohttp/3.7.4.post0"}, {"name": "X-Forwarded-For", "value": "3.11.106.35"}, {"name": "X-Forwarded-Port", "value": "443"}, {"name": "X-Forwarded-Proto", "value": "https"}], "uRI": "/oauth2-pr-251/userinfo", "verb": "GET"}, {"ActionResult": "VariableAccess", "accessList": [{"Get": {"name": "request.queryparam.scope"}}, {"Set": {"name": "apigee.metrics.policy.AssignMessage.ExtractExternalScope.timeTaken", "success": true, "value": "3971"}}]}]}, {"id": "Execution", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "action", "value": "CONTINUE"}, {"name": "stepDefinition-async", "value": "false"}, {"name": "internal", "value": "false"}, {"name": "stepDefinition-type", "value": "assignmessage"}, {"name": "type", "value": "AssignMessageExecution"}, {"name": "enforcement", "value": "request"}, {"name": "stepDefinition-continueOnError", "value": "false"}, {"name": "stepDefinition-displayName", "value": "AssignMessage.RemoveExternalScope"}, {"name": "stepDefinition-name", "value": "AssignMessage.RemoveExternalScope"}, {"name": "stepDefinition-enabled", "value": "true"}, {"name": "result", "value": "true"}]}, "timestamp": "03-11-21 16:50:06:979"}, {"ActionResult": "RequestMessage", "headers": [{"name": "Accept", "value": "*/*"}, {"name": "Accept-Encoding", "value": "gzip,deflate"}, {"name": "Authorization", "value": "*****"}, {"name": "Host", "value": "internal-dev.api.service.nhs.uk"}, {"name": "NHSD-Correlation-ID", "value": "..rrt-4658976038220403375-a-geu2-24021-103322-1"}, {"name": "NHSD-Request-ID", "value": ""}, {"name": "User-Agent", "value": "Python/3.9 aiohttp/3.7.4.post0"}, {"name": "X-Forwarded-For", "value": "3.11.106.35"}, {"name": "X-Forwarded-Port", "value": "443"}, {"name": "X-Forwarded-Proto", "value": "https"}], "uRI": "/oauth2-pr-251/userinfo", "verb": "GET"}, {"ActionResult": "VariableAccess", "accessList": [{"Set": {"name": "apigee.metrics.policy.AssignMessage.RemoveExternalScope.timeTaken", "success": true, "value": "3499"}}]}]}, {"id": "Execution", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "action", "value": "CONTINUE"}, {"name": "stepDefinition-async", "value": "false"}, {"name": "internal", "value": "false"}, {"name": "stepDefinition-type", "value": "assignmessage"}, {"name": "type", "value": "AssignMessageExecution"}, {"name": "enforcement", "value": "request"}, {"name": "stepDefinition-continueOnError", "value": "false"}, {"name": "stepDefinition-displayName", "value": "Set APIM Guids"}, {"name": "stepDefinition-name", "value": "AssignMessage.SetApimGuids"}, {"name": "stepDefinition-enabled", "value": "true"}, {"name": "result", "value": "true"}]}, "timestamp": "03-11-21 16:50:06:979"}, {"ActionResult": "RequestMessage", "headers": [{"name": "Accept", "value": "*/*"}, {"name": "Accept-Encoding", "value": "gzip,deflate"}, {"name": "Authorization", "value": "*****"}, {"name": "Host", "value": "internal-dev.api.service.nhs.uk"}, {"name": "NHSD-Correlation-ID", "value": "..rrt-4658976038220403375-a-geu2-24021-103322-1"}, {"name": "NHSD-Request-ID", "value": ""}, {"name": "User-Agent", "value": "Python/3.9 aiohttp/3.7.4.post0"}, {"name": "X-Forwarded-For", "value": "3.11.106.35"}, {"name": "X-Forwarded-Port", "value": "443"}, {"name": "X-Forwarded-Proto", "value": "https"}], "uRI": "/oauth2-pr-251/userinfo", "verb": "GET"}, {"ActionResult": "VariableAccess", "accessList": [{"Set": {"name": "apim.api_guid", "success": true, "value": "d5a3f4fc-e61f-41f3-ab72-16aa5ef3ff2b"}}, {"Set": {"name": "apim.api_spec_guid", "success": true, "value": ""}}, {"Set": {"name": "apigee.metrics.policy.AssignMessage.SetApimGuids.timeTaken", "success": true, "value": "3191"}}]}]}, {"id": "Condition", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "ExpressionResult", "value": "false"}, {"name": "Expression", "value": "(proxy.pathsuffix matches /_ping and ((request.verb equals \"GET\") or (request.verb equals \"HEAD\")))"}, {"name": "Tree", "value": "AddPayloadToPing_REQUEST_FLOW"}]}, "timestamp": "03-11-21 16:50:06:979"}, {"ActionResult": "VariableAccess", "accessList": [{"Get": {"name": "proxy.pathsuffix", "value": "/userinfo"}}]}]}, {"id": "Condition", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "ExpressionResult", "value": "false"}, {"name": "Expression", "value": "(proxy.pathsuffix matches /authorize and (request.verb equals \"GET\"))"}, {"name": "Tree", "value": "Flow.GetAuthorization_REQUEST_FLOW"}]}, "timestamp": "03-11-21 16:50:06:979"}, {"ActionResult": "VariableAccess", "accessList": [{"Get": {"name": "proxy.pathsuffix", "value": "/userinfo"}}]}]}, {"id": "Condition", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "ExpressionResult", "value": "false"}, {"name": "Expression", "value": "(proxy.pathsuffix matches /token and ((request.verb equals \"POST\") and ((request.formparam.grant_type equals \"client_credentials\") and (request.formparam.subject_token_type not equals \"urn:ietf:params:oauth:token-type:id_token\"))))"}, {"name": "Tree", "value": "Flow.PostTokenClientCredentials_REQUEST_FLOW"}]}, "timestamp": "03-11-21 16:50:06:979"}, {"ActionResult": "VariableAccess", "accessList": [{"Get": {"name": "proxy.pathsuffix", "value": "/userinfo"}}]}]}, {"id": "Condition", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "ExpressionResult", "value": "false"}, {"name": "Expression", "value": "(proxy.pathsuffix matches /token and ((request.verb equals \"POST\") and ((request.formparam.subject_token_type equals \"urn:ietf:params:oauth:token-type:id_token\") and (apim.feature_toggles.enable-token-exchange equals true))))"}, {"name": "Tree", "value": "Flow.PostTokenTokenExchange_REQUEST_FLOW"}]}, "timestamp": "03-11-21 16:50:06:979"}, {"ActionResult": "VariableAccess", "accessList": [{"Get": {"name": "proxy.pathsuffix", "value": "/userinfo"}}]}]}, {"id": "Condition", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "ExpressionResult", "value": "false"}, {"name": "Expression", "value": "(proxy.pathsuffix matches /backchannel_logout and (request.verb equals \"POST\"))"}, {"name": "Tree", "value": "Flow.BackChannelLogout_REQUEST_FLOW"}]}, "timestamp": "03-11-21 16:50:06:979"}, {"ActionResult": "VariableAccess", "accessList": [{"Get": {"name": "proxy.pathsuffix", "value": "/userinfo"}}]}]}, {"id": "Condition", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "ExpressionResult", "value": "false"}, {"name": "Expression", "value": "(proxy.pathsuffix matches /token and ((request.verb equals \"POST\") and (request.formparam.grant_type equals \"authorization_code\")))"}, {"name": "Tree", "value": "Flow.PostTokenAuthorizationCode_REQUEST_FLOW"}]}, "timestamp": "03-11-21 16:50:06:979"}, {"ActionResult": "VariableAccess", "accessList": [{"Get": {"name": "proxy.pathsuffix", "value": "/userinfo"}}]}]}, {"id": "Condition", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "ExpressionResult", "value": "false"}, {"name": "Expression", "value": "(proxy.pathsuffix matches /token and ((request.verb equals \"POST\") and (request.formparam.grant_type equals \"refresh_token\")))"}, {"name": "Tree", "value": "Flow.PostRefreshToken_REQUEST_FLOW"}]}, "timestamp": "03-11-21 16:50:06:979"}, {"ActionResult": "VariableAccess", "accessList": [{"Get": {"name": "proxy.pathsuffix", "value": "/userinfo"}}]}]}, {"id": "Condition", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "ExpressionResult", "value": "false"}, {"name": "Expression", "value": "(proxy.pathsuffix matches /callback and (request.verb equals \"GET\"))"}, {"name": "Tree", "value": "Flow.GetCallback_REQUEST_FLOW"}]}, "timestamp": "03-11-21 16:50:06:979"}, {"ActionResult": "VariableAccess", "accessList": [{"Get": {"name": "proxy.pathsuffix", "value": "/userinfo"}}]}]}, {"id": "Condition", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "ExpressionResult", "value": "true"}, {"name": "Expression", "value": "(proxy.pathsuffix matches /userinfo and (request.verb equals \"GET\"))"}, {"name": "Tree", "value": "Flow.GetUserInfo_REQUEST_FLOW"}]}, "timestamp": "03-11-21 16:50:06:979"}, {"ActionResult": "VariableAccess", "accessList": [{"Get": {"name": "proxy.pathsuffix", "value": "/userinfo"}}, {"Get": {"name": "request.verb", "value": "GET"}}]}]}, {"id": "FlowInfo", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "proxy.flow.name", "value": "Flow.GetUserInfo"}, {"name": "proxy.flow.description", "value": ""}]}, "timestamp": "03-11-21 16:50:06:979"}]}, {"id": "FlowInfo", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "current.flow.name", "value": "Flow.GetUserInfo"}, {"name": "current.flow.description", "value": ""}]}, "timestamp": "03-11-21 16:50:06:979"}]}, {"id": "Paused", "results": []}, {"id": "FlowInfo", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "oauthV2.OAuthV2.VerifyAccessToken.failed", "value": "false"}, {"name": "oauthV2.OAuthV2.VerifyAccessToken.fault.name", "value": ""}, {"name": "oauthV2.OAuthV2.VerifyAccessToken.fault.cause", "value": ""}]}, "timestamp": "03-11-21 16:50:06:988"}]}, {"id": "FlowInfo", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "Identifier", "value": "app"}]}, "timestamp": "03-11-21 16:50:06:988"}]}, {"id": "FlowInfo", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "Identifier", "value": "developer"}]}, "timestamp": "03-11-21 16:50:06:988"}]}, {"id": "Execution", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "action", "value": "CONTINUE"}, {"name": "stepDefinition-async", "value": "false"}, {"name": "internal", "value": "false"}, {"name": "stepDefinition-type", "value": "oauthV2"}, {"name": "type", "value": "VerifyAccessTokenStepExecution"}, {"name": "enforcement", "value": "request"}, {"name": "stepDefinition-continueOnError", "value": "false"}, {"name": "stepDefinition-displayName", "value": "OAuthV2.VerifyAccessToken"}, {"name": "stepDefinition-name", "value": "OAuthV2.VerifyAccessToken"}, {"name": "stepDefinition-enabled", "value": "true"}, {"name": "result", "value": "true"}]}, "timestamp": "03-11-21 16:50:06:988"}, {"ActionResult": "RequestMessage", "headers": [{"name": "Accept", "value": "*/*"}, {"name": "Accept-Encoding", "value": "gzip,deflate"}, {"name": "Authorization", "value": "*****"}, {"name": "Host", "value": "internal-dev.api.service.nhs.uk"}, {"name": "NHSD-Correlation-ID", "value": "..rrt-4658976038220403375-a-geu2-24021-103322-1"}, {"name": "NHSD-Request-ID", "value": ""}, {"name": "User-Agent", "value": "Python/3.9 aiohttp/3.7.4.post0"}, {"name": "X-Forwarded-For", "value": "3.11.106.35"}, {"name": "X-Forwarded-Port", "value": "443"}, {"name": "X-Forwarded-Proto", "value": "https"}], "uRI": "/oauth2-pr-251/userinfo", "verb": "GET"}, {"ActionResult": "VariableAccess", "accessList": [{"Get": {"name": "oauthV2.OAuthV2.VerifyAccessToken"}}, {"Get": {"name": "flow.resource.name"}}, {"Get": {"name": "environment.name", "value": "internal-dev"}}, {"Get": {"name": "apiproxy.name", "value": "identity-service-pr-251"}}, {"Get": {"name": "proxy.pathsuffix", "value": "/userinfo"}}, {"Set": {"name": "refresh_token_expires_in", "success": true, "value": "3599"}}, {"Set": {"name": "accesstoken.id_token-amr", "success": true, "value": "[N3_SMARTCARD]"}}, {"Set": {"name": "apiproduct.ratelimit", "success": true, "value": "1000ps"}}, {"Set": {"name": "accesstoken.external_access_token", "success": true, "value": "eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICJKY3lCTU9LRDF2RnhJSDBoWVJ6Yktrc3V2d3QyNEl3dEhFSU5wS3JKelpZIn0.eyJleHAiOjE2MzU5NTg1MDUsImlhdCI6MTYzNTk1ODIwNSwiYXV0aF90aW1lIjoxNjM1OTU4MjA1LCJqdGkiOiI1ZTFlMDYyOC03ZDI3LTQyZWQtYjg5Mi03YjZjNTkxODRiYTEiLCJpc3MiOiJodHRwczovL2lkZW50aXR5LnB0bC5hcGkucGxhdGZvcm0ubmhzLnVrL2F1dGgvcmVhbG1zL2NpczItbW9jayIsInN1YiI6IjQyM2RmZjY3LWUwODUtNGIwNC04NDdmLTQ5MDE1NmJjNzY5MyIsInR5cCI6IkJlYXJlciIsImF6cCI6InRlc3QtY2xpZW50LTEiLCJzZXNzaW9uX3N0YXRlIjoiNGZmMzA0MDYtMTU3Ni00MmQwLTkxYTMtMmUwY2ZjMGYxODEwIiwiYWNyIjoiMSIsInNjb3BlIjoib3BlbmlkIHByb2ZpbGUgbmF0aW9uYWxyYmFjYWNjZXNzIGVtYWlsIiwic2lkIjoiNGZmMzA0MDYtMTU3Ni00MmQwLTkxYTMtMmUwY2ZjMGYxODEwIiwiYWNyIjoiQUFMM19BTlkiLCJhdWRpdFRyYWNraW5nSWQiOiI5MWY2OTRlNi0zNzQ5LTQyZmQtOTBiMC1ET05PVENIQU5HRS0xNTQ2MzkxIiwiYW1yIjpbIk4zX1NNQVJUQ0FSRCJdfQ.bW187J-UrvSkrFwL2GUFvmSFezvYUgh8onPJCyJpkVyYyOd4EMSwDi6Rqwi3ORo9iT44CkVynnH7K1GXgaG1GqNEDnEr8GkKhf5mUB50mrNnAKYw76z7ulpZrfbUuvaNZaECO6rAxl0CQw-Qjz3kVRvOkTnm5qffgnAx0oy71OVm5TohC3b2WKqWoUypIFevG_gp2Wp82hdz72Ix4tyQxyGuZGe8uJ25RHzOoT7nC72QG-IyLoM-w34TpNkZEhGWZaZ7Gfd1no5BWTBpEPaQrGYTE5tOeAG5oeLXIOj9oEIpD-HebtYuvvelo9fNGXKTMOJ5j-8A1e_jSeFsuLSsBw"}}, {"Set": {"name": "accesstoken.auth_level", "success": true, "value": "aal3"}}, {"Set": {"name": "token_type", "success": true, "value": "BearerToken"}}, {"Set": {"name": "issued_at", "success": true, "value": "1635958206680"}}, {"Set": {"name": "client_id", "success": true, "value": "2wv2G3YK2RPFucAQUA9yxlvo0qtlBr7s"}}, {"Set": {"name": "accesstoken.id_token", "success": true, "value": "eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICJKY3lCTU9LRDF2RnhJSDBoWVJ6Yktrc3V2d3QyNEl3dEhFSU5wS3JKelpZIn0.eyJleHAiOjE2MzU5NTg1MDUsImlhdCI6MTYzNTk1ODIwNSwiYXV0aF90aW1lIjoxNjM1OTU4MjA1LCJqdGkiOiI3MjdkZWY3ZS1hZGZhLTQ1N2MtOTc1OS1lNWMxZTQxMjRhOGEiLCJpc3MiOiJodHRwczovL2lkZW50aXR5LnB0bC5hcGkucGxhdGZvcm0ubmhzLnVrL2F1dGgvcmVhbG1zL2NpczItbW9jayIsImF1ZCI6InRlc3QtY2xpZW50LTEiLCJzdWIiOiI0MjNkZmY2Ny1lMDg1LTRiMDQtODQ3Zi00OTAxNTZiYzc2OTMiLCJ0eXAiOiJJRCIsImF6cCI6InRlc3QtY2xpZW50LTEiLCJzZXNzaW9uX3N0YXRlIjoiNGZmMzA0MDYtMTU3Ni00MmQwLTkxYTMtMmUwY2ZjMGYxODEwIiwiYXRfaGFzaCI6InNlTlgzZlpUSU44YXlSOWNwQTd3RkEiLCJhY3IiOiIxIiwic2lkIjoiNGZmMzA0MDYtMTU3Ni00MmQwLTkxYTMtMmUwY2ZjMGYxODEwIiwiYWNyIjoiQUFMM19BTlkiLCJhdWRpdFRyYWNraW5nSWQiOiI5MWY2OTRlNi0zNzQ5LTQyZmQtOTBiMC1ET05PVENIQU5HRS0xNTQ2MzkxIiwiYW1yIjpbIk4zX1NNQVJUQ0FSRCJdfQ.UBFdCYe1clI0XZMgrESNweP6YXWbM3uU5FNti5J1Cmh_2qQ7vYuvz2s-WKjcnW8dCIh9qrYTwyxMoFL-RNgME1Lbh6YgF90iOZ86E3j99alnLAP89ju1Y7TIleAb_tgrACiPxUt4KFeFj3stIzq1XQGTAOy2W7ercyXyPhPMwmCEjnhkUa0c_oNmH__kLkWulLVKMJZrwHS-ADDRJXGBlSnIk3Wz6Pxx_QJ1i6_Ho2QY65T73dH2CzT0H9Q7i39kRYWkuM0OHM4if0m1RzqhyJjaRUhUxFBT-ABzPIf9Z4rrwdLQvyudJr0Bjuj-4oIS_BCyb4sRyKqJEbdYdEkKjA"}}, {"Set": {"name": "developer.app.id", "success": true, "value": "dca12c22-082c-4d8f-9e5b-5a113e926d2c"}}, {"Set": {"name": "developer.id", "success": true, "value": "nhsd-nonprod@@@ba00a768-3783-46f6-bf41-4033d2bf669d"}}, {"Set": {"name": "accesstoken.issuer", "success": true, "value": "https://internal-dev.api.service.nhs.uk/oauth2-pr-251"}}, {"Set": {"name": "developer.app.name", "success": true, "value": "apim-auto-c7023f90-2533-499e-b73b-edd2d3d24ec8"}}, {"Set": {"name": "accesstoken.id_token-acr", "success": true, "value": "AAL3_ANY"}}, {"Set": {"name": "grant_type", "success": true, "value": "authorization_code"}}, {"Set": {"name": "accesstoken.auth_type", "success": true, "value": "user"}}, {"Set": {"name": "scope", "success": true, "value": "urn:nhsd:apim:user-nhs-id:aal3:personal-demographics-service"}}, {"Set": {"name": "accesstoken.auth_user_id", "success": true, "value": "423dff67-e085-4b04-847f-490156bc7693"}}, {"Set": {"name": "refresh_token_issued_at", "success": true, "value": "1635958206680"}}, {"Set": {"name": "accesstoken._first_issued", "success": true, "value": "1635958206678"}}, {"Set": {"name": "expires_in", "success": true, "value": "4"}}, {"Set": {"name": "apiproduct.access", "success": true, "value": "public"}}, {"Set": {"name": "apiproduct.developer.quota.timeunit", "success": true, "value": "minute"}}, {"Set": {"name": "app", "success": true, "value": "dca12c22-082c-4d8f-9e5b-5a113e926d2c"}}, {"Set": {"name": "apiproduct.developer.quota.limit", "success": true, "value": "60000"}}, {"Set": {"name": "refresh_token_status", "success": true, "value": "approved"}}, {"Set": {"name": "apiproduct.developer.quota.interval", "success": true, "value": "1"}}, {"Set": {"name": "apiproduct.name", "success": true, "value": "apim-auto-857ac0f7-291f-47f4-b7b0-25f78da5508c"}}, {"Set": {"name": "organization_name", "success": true, "value": "nhsd-nonprod"}}, {"Set": {"name": "developer.email", "success": true, "value": "apm-testing-internal-dev@nhs.net"}}, {"Set": {"name": "access_token", "success": true, "value": "dQom5uWPEllqzyAMQyAzL8xLcOAV"}}, {"Set": {"name": "accesstoken.id_token-issuer", "success": true, "value": "https://identity.ptl.api.platform.nhs.uk/auth/realms/cis2-mock"}}, {"Set": {"name": "refresh_token", "success": true, "value": "0QldOs1ItSZEo5WG8IDzifAVdPAIPxKX"}}, {"Set": {"name": "accesstoken.auth_provider", "success": true, "value": "nhs-cis2"}}, {"Set": {"name": "accesstoken.auth_grant_type", "success": true, "value": "authorization_code"}}, {"Set": {"name": "accesstoken.id_token-subject", "success": true, "value": "423dff67-e085-4b04-847f-490156bc7693"}}, {"Set": {"name": "status", "success": true, "value": "approved"}}, {"Set": {"name": "apigee.client_id", "success": true, "value": "2wv2G3YK2RPFucAQUA9yxlvo0qtlBr7s"}}, {"Set": {"name": "apigee.developer.id", "success": true, "value": "nhsd-nonprod@@@ba00a768-3783-46f6-bf41-4033d2bf669d"}}, {"Set": {"name": "apigee.developer.app.name", "success": true, "value": "apim-auto-c7023f90-2533-499e-b73b-edd2d3d24ec8"}}, {"Set": {"name": "apigee.apiproduct.name", "success": true, "value": "apim-auto-857ac0f7-291f-47f4-b7b0-25f78da5508c"}}, {"Set": {"name": "apigee.developer.email", "success": true, "value": "apm-testing-internal-dev@nhs.net"}}, {"Set": {"name": "apigee.access_token", "success": true, "value": "dQom5uWPEllqzyAMQyAzL8xLcOAV"}}, {"Get": {"name": "organization.name", "value": "nhsd-nonprod"}}, {"Get": {"name": "organization.name", "value": "nhsd-nonprod"}}, {"Set": {"name": "oauthV2.failed", "success": true, "value": "false"}}, {"Get": {"name": "environment.name", "value": "internal-dev"}}, {"Get": {"name": "apiproxy.name", "value": "identity-service-pr-251"}}, {"Get": {"name": "proxy.pathsuffix", "value": "/userinfo"}}, {"Set": {"name": "apigee.metrics.policy.OAuthV2.VerifyAccessToken.timeTaken", "success": true, "value": "8988548"}}]}]}, {"id": "Resumed", "results": []}, {"id": "Execution", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "action", "value": "CONTINUE"}, {"name": "stepDefinition-async", "value": "false"}, {"name": "internal", "value": "false"}, {"name": "stepDefinition-type", "value": "flowcallout"}, {"name": "type", "value": "FlowCalloutStepExecution"}, {"name": "enforcement", "value": "request"}, {"name": "stepDefinition-continueOnError", "value": "false"}, {"name": "stepDefinition-displayName", "value": "Apply Rate Limiting"}, {"name": "stepDefinition-name", "value": "FlowCallout.ApplyRatelimiting"}, {"name": "stepDefinition-enabled", "value": "true"}, {"name": "result", "value": "true"}]}, "timestamp": "03-11-21 16:50:06:988"}, {"ActionResult": "RequestMessage", "headers": [{"name": "Accept", "value": "*/*"}, {"name": "Accept-Encoding", "value": "gzip,deflate"}, {"name": "Authorization", "value": "*****"}, {"name": "Host", "value": "internal-dev.api.service.nhs.uk"}, {"name": "NHSD-Correlation-ID", "value": "..rrt-4658976038220403375-a-geu2-24021-103322-1"}, {"name": "NHSD-Request-ID", "value": ""}, {"name": "User-Agent", "value": "Python/3.9 aiohttp/3.7.4.post0"}, {"name": "X-Forwarded-For", "value": "3.11.106.35"}, {"name": "X-Forwarded-Port", "value": "443"}, {"name": "X-Forwarded-Proto", "value": "https"}], "uRI": "/oauth2-pr-251/userinfo", "verb": "GET"}, {"ActionResult": "VariableAccess", "accessList": [{"Set": {"name": "apigee.metrics.policy.FlowCallout.ApplyRatelimiting.timeTaken", "success": true, "value": "9420"}}]}]}, {"id": "FlowCallout", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "shared.flow.name", "value": "ApplyRateLimiting"}]}, "timestamp": "03-11-21 16:50:06:988"}]}, {"id": "Paused", "results": []}, {"id": "Execution", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "javascript-executionTime", "value": "0"}, {"name": "action", "value": "CONTINUE"}, {"name": "javascript-timeLimit", "value": "200"}, {"name": "stepDefinition-async", "value": "false"}, {"name": "internal", "value": "false"}, {"name": "stepDefinition-type", "value": "javascript"}, {"name": "javascript-name", "value": "set-ratelimits.js"}, {"name": "type", "value": "JavascriptStepExecution"}, {"name": "enforcement", "value": "request"}, {"name": "stepDefinition-continueOnError", "value": "false"}, {"name": "stepDefinition-displayName", "value": "Javascript.SetRatelimits"}, {"name": "stepDefinition-name", "value": "Javascript.SetRatelimits"}, {"name": "stepDefinition-enabled", "value": "true"}, {"name": "result", "value": "true"}]}, "timestamp": "03-11-21 16:50:06:988"}, {"ActionResult": "RequestMessage", "headers": [{"name": "Accept", "value": "*/*"}, {"name": "Accept-Encoding", "value": "gzip,deflate"}, {"name": "Authorization", "value": "*****"}, {"name": "Host", "value": "internal-dev.api.service.nhs.uk"}, {"name": "NHSD-Correlation-ID", "value": "..rrt-4658976038220403375-a-geu2-24021-103322-1"}, {"name": "NHSD-Request-ID", "value": ""}, {"name": "User-Agent", "value": "Python/3.9 aiohttp/3.7.4.post0"}, {"name": "X-Forwarded-For", "value": "3.11.106.35"}, {"name": "X-Forwarded-Port", "value": "443"}, {"name": "X-Forwarded-Proto", "value": "https"}], "uRI": "/oauth2-pr-251/userinfo", "verb": "GET"}, {"ActionResult": "VariableAccess", "accessList": [{"Get": {"name": "verifyApiKeyPolicyName"}}, {"Get": {"name": "apiproxy.name", "value": "identity-service-pr-251"}}, {"Get": {"name": "apiproduct.developer.quota.limit", "value": "60000"}}, {"Get": {"name": "apiproduct.developer.quota.interval", "value": "1"}}, {"Get": {"name": "apiproduct.developer.quota.timeunit", "value": "minute"}}, {"Get": {"name": "apiproduct.ratelimit", "value": "1000ps"}}, {"Get": {"name": "ratelimiting", "value": "{\n    \"app\": {\n        \"quota\": {\n            \"enabled\": true,\n            \"interval\": 1,\n            \"limit\": 300,\n            \"timeunit\": \"minute\"\n        },\n        \"spikeArrest\": {\n            \"enabled\": false\n        }\n    },\n    \"proxy\": {\n        \"quota\": {\n            \"enabled\": false\n        },\n        \"spikeArrest\": {\n            \"enabled\": true,\n            \"ratelimit\": \"300000pm\"\n        }\n    }\n}"}}, {"Get": {"name": "app.ratelimiting"}}, {"Get": {"name": "apiproduct.ratelimiting"}}, {"Get": {"name": "ratelimiting", "value": "{\n    \"app\": {\n        \"quota\": {\n            \"enabled\": true,\n            \"interval\": 1,\n            \"limit\": 300,\n            \"timeunit\": \"minute\"\n        },\n        \"spikeArrest\": {\n            \"enabled\": false\n        }\n    },\n    \"proxy\": {\n        \"quota\": {\n            \"enabled\": false\n        },\n        \"spikeArrest\": {\n            \"enabled\": true,\n            \"ratelimit\": \"300000pm\"\n        }\n    }\n}"}}, {"Set": {"name": "proxy_quota_enabled", "success": true, "value": "false"}}, {"Set": {"name": "proxy_spikeArrest_enabled", "success": true, "value": "true"}}, {"Set": {"name": "proxy_spikeArrest_ratelimit", "success": true, "value": "300000pm"}}, {"Set": {"name": "app_quota_limit", "success": true, "value": "300"}}, {"Set": {"name": "app_quota_interval", "success": true, "value": "1"}}, {"Set": {"name": "app_quota_timeunit", "success": true, "value": "minute"}}, {"Set": {"name": "app_quota_enabled", "success": true, "value": "true"}}, {"Set": {"name": "app_spikeArrest_ratelimit", "success": true, "value": "1000ps"}}, {"Set": {"name": "app_spikeArrest_enabled", "success": true, "value": "false"}}, {"Set": {"name": "apigee.metrics.policy.Javascript.SetRatelimits.timeTaken", "success": true, "value": "240623"}}]}]}, {"id": "Resumed", "results": []}, {"id": "Paused", "results": []}, {"id": "FlowInfo", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "ratelimit.QuotaPerApp.expiry.time", "value": "1635958206989"}, {"name": "ratelimit.QuotaPerApp.failed", "value": "false"}, {"name": "ratelimit.QuotaPerApp.datastore.fail.open", "value": "false"}, {"name": "ratelimit.QuotaPerApp.class.total.exceed.count", "value": "0"}, {"name": "ratelimit.QuotaPerApp.allowed.count", "value": "300"}, {"name": "ratelimit.QuotaPerApp.fault.name", "value": ""}, {"name": "ratelimit.QuotaPerApp.class.used.count", "value": "0"}, {"name": "ratelimit.QuotaPerApp.class.available.count", "value": "0"}, {"name": "ratelimit.QuotaPerApp.total.exceed.count", "value": "0"}, {"name": "ratelimit.QuotaPerApp.class.allowed.count", "value": "0"}, {"name": "ratelimit.QuotaPerApp.used.count", "value": "4"}, {"name": "ratelimit.QuotaPerApp.identifier", "value": "dca12c22-082c-4d8f-9e5b-5a113e926d2c"}, {"name": "ratelimit.QuotaPerApp.exceed.count", "value": "0"}, {"name": "ratelimit.QuotaPerApp.class.exceed.count", "value": "0"}, {"name": "ratelimit.QuotaPerApp.available.count", "value": "296"}, {"name": "ratelimit.QuotaPerApp.fault.cause", "value": ""}]}, "timestamp": "03-11-21 16:50:06:992"}]}, {"id": "Execution", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "action", "value": "CONTINUE"}, {"name": "stepDefinition-async", "value": "false"}, {"name": "internal", "value": "false"}, {"name": "stepDefinition-type", "value": "Quota"}, {"name": "expression", "value": "(app_quota_enabled equals true)"}, {"name": "type", "value": "RateLimitExecution"}, {"name": "enforcement", "value": "request"}, {"name": "stepDefinition-continueOnError", "value": "true"}, {"name": "expressionResult", "value": "true"}, {"name": "stepDefinition-displayName", "value": "Quota Per App"}, {"name": "stepDefinition-name", "value": "QuotaPerApp"}, {"name": "stepDefinition-enabled", "value": "true"}, {"name": "result", "value": "true"}]}, "timestamp": "03-11-21 16:50:06:992"}, {"ActionResult": "RequestMessage", "headers": [{"name": "Accept", "value": "*/*"}, {"name": "Accept-Encoding", "value": "gzip,deflate"}, {"name": "Authorization", "value": "*****"}, {"name": "Host", "value": "internal-dev.api.service.nhs.uk"}, {"name": "NHSD-Correlation-ID", "value": "..rrt-4658976038220403375-a-geu2-24021-103322-1"}, {"name": "NHSD-Request-ID", "value": ""}, {"name": "User-Agent", "value": "Python/3.9 aiohttp/3.7.4.post0"}, {"name": "X-Forwarded-For", "value": "3.11.106.35"}, {"name": "X-Forwarded-Port", "value": "443"}, {"name": "X-Forwarded-Proto", "value": "https"}], "uRI": "/oauth2-pr-251/userinfo", "verb": "GET"}, {"ActionResult": "VariableAccess", "accessList": [{"Get": {"name": "app_quota_interval", "value": "1"}}, {"Get": {"name": "app_quota_timeunit", "value": "minute"}}, {"Get": {"name": "developer.app.id", "value": "dca12c22-082c-4d8f-9e5b-5a113e926d2c"}}, {"Get": {"name": "app_quota_limit", "value": "300"}}, {"Set": {"name": "apigee.metrics.policy.QuotaPerApp.timeTaken", "success": true, "value": "3253170"}}]}]}, {"id": "Resumed", "results": []}, {"id": "Execution", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "stepDefinition-async", "value": "false"}, {"name": "internal", "value": "false"}, {"name": "stepDefinition-type", "value": "raisefault"}, {"name": "expression", "value": "(ratelimit.QuotaPerApp.failed equals true)"}, {"name": "type", "value": "RaiseFaultExecution"}, {"name": "enforcement", "value": "request"}, {"name": "stepDefinition-continueOnError", "value": "false"}, {"name": "expressionResult", "value": "false"}, {"name": "stepDefinition-displayName", "value": "RaiseFault.QuotaPerApp"}, {"name": "stepDefinition-name", "value": "RaiseFault.QuotaPerApp"}, {"name": "stepDefinition-enabled", "value": "true"}]}, "timestamp": "03-11-21 16:50:06:992"}, {"ActionResult": "RequestMessage", "headers": [{"name": "Accept", "value": "*/*"}, {"name": "Accept-Encoding", "value": "gzip,deflate"}, {"name": "Authorization", "value": "*****"}, {"name": "Host", "value": "internal-dev.api.service.nhs.uk"}, {"name": "NHSD-Correlation-ID", "value": "..rrt-4658976038220403375-a-geu2-24021-103322-1"}, {"name": "NHSD-Request-ID", "value": ""}, {"name": "User-Agent", "value": "Python/3.9 aiohttp/3.7.4.post0"}, {"name": "X-Forwarded-For", "value": "3.11.106.35"}, {"name": "X-Forwarded-Port", "value": "443"}, {"name": "X-Forwarded-Proto", "value": "https"}], "uRI": "/oauth2-pr-251/userinfo", "verb": "GET"}, {"ActionResult": "VariableAccess", "accessList": [{"Get": {"name": "app_quota_interval", "value": "1"}}, {"Get": {"name": "app_quota_timeunit", "value": "minute"}}, {"Get": {"name": "developer.app.id", "value": "dca12c22-082c-4d8f-9e5b-5a113e926d2c"}}, {"Get": {"name": "app_quota_limit", "value": "300"}}, {"Set": {"name": "apigee.metrics.policy.QuotaPerApp.timeTaken", "success": true, "value": "3253170"}}, {"Get": {"name": "ratelimit.QuotaPerApp.failed", "value": "false"}}]}]}, {"id": "Execution", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "stepDefinition-async", "value": "false"}, {"name": "internal", "value": "false"}, {"name": "stepDefinition-type", "value": "SpikeArrest"}, {"name": "expression", "value": "(app_spikeArrest_enabled equals true)"}, {"name": "type", "value": "RateLimitExecution"}, {"name": "enforcement", "value": "request"}, {"name": "stepDefinition-continueOnError", "value": "true"}, {"name": "expressionResult", "value": "false"}, {"name": "stepDefinition-displayName", "value": "Per-app Spike Arrest"}, {"name": "stepDefinition-name", "value": "SpikeArrestPerApp"}, {"name": "stepDefinition-enabled", "value": "true"}]}, "timestamp": "03-11-21 16:50:06:992"}, {"ActionResult": "RequestMessage", "headers": [{"name": "Accept", "value": "*/*"}, {"name": "Accept-Encoding", "value": "gzip,deflate"}, {"name": "Authorization", "value": "*****"}, {"name": "Host", "value": "internal-dev.api.service.nhs.uk"}, {"name": "NHSD-Correlation-ID", "value": "..rrt-4658976038220403375-a-geu2-24021-103322-1"}, {"name": "NHSD-Request-ID", "value": ""}, {"name": "User-Agent", "value": "Python/3.9 aiohttp/3.7.4.post0"}, {"name": "X-Forwarded-For", "value": "3.11.106.35"}, {"name": "X-Forwarded-Port", "value": "443"}, {"name": "X-Forwarded-Proto", "value": "https"}], "uRI": "/oauth2-pr-251/userinfo", "verb": "GET"}, {"ActionResult": "VariableAccess", "accessList": [{"Get": {"name": "app_spikeArrest_enabled", "value": "false"}}]}]}, {"id": "Execution", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "stepDefinition-async", "value": "false"}, {"name": "internal", "value": "false"}, {"name": "stepDefinition-type", "value": "raisefault"}, {"name": "expression", "value": "(ratelimit.SpikeArrestPerApp.failed equals true)"}, {"name": "type", "value": "RaiseFaultExecution"}, {"name": "enforcement", "value": "request"}, {"name": "stepDefinition-continueOnError", "value": "false"}, {"name": "expressionResult", "value": "false"}, {"name": "stepDefinition-displayName", "value": "RaiseFault.SpikeArrestPerApp"}, {"name": "stepDefinition-name", "value": "RaiseFault.SpikeArrestPerApp"}, {"name": "stepDefinition-enabled", "value": "true"}]}, "timestamp": "03-11-21 16:50:06:992"}, {"ActionResult": "RequestMessage", "headers": [{"name": "Accept", "value": "*/*"}, {"name": "Accept-Encoding", "value": "gzip,deflate"}, {"name": "Authorization", "value": "*****"}, {"name": "Host", "value": "internal-dev.api.service.nhs.uk"}, {"name": "NHSD-Correlation-ID", "value": "..rrt-4658976038220403375-a-geu2-24021-103322-1"}, {"name": "NHSD-Request-ID", "value": ""}, {"name": "User-Agent", "value": "Python/3.9 aiohttp/3.7.4.post0"}, {"name": "X-Forwarded-For", "value": "3.11.106.35"}, {"name": "X-Forwarded-Port", "value": "443"}, {"name": "X-Forwarded-Proto", "value": "https"}], "uRI": "/oauth2-pr-251/userinfo", "verb": "GET"}, {"ActionResult": "VariableAccess", "accessList": [{"Get": {"name": "ratelimit.SpikeArrestPerApp.failed"}}]}]}, {"id": "Execution", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "stepDefinition-async", "value": "false"}, {"name": "internal", "value": "false"}, {"name": "stepDefinition-type", "value": "Quota"}, {"name": "expression", "value": "(proxy_quota_enabled equals true)"}, {"name": "type", "value": "RateLimitExecution"}, {"name": "enforcement", "value": "request"}, {"name": "stepDefinition-continueOnError", "value": "true"}, {"name": "expressionResult", "value": "false"}, {"name": "stepDefinition-displayName", "value": "Quota Per Proxy"}, {"name": "stepDefinition-name", "value": "QuotaPerProxy"}, {"name": "stepDefinition-enabled", "value": "true"}]}, "timestamp": "03-11-21 16:50:06:992"}, {"ActionResult": "RequestMessage", "headers": [{"name": "Accept", "value": "*/*"}, {"name": "Accept-Encoding", "value": "gzip,deflate"}, {"name": "Authorization", "value": "*****"}, {"name": "Host", "value": "internal-dev.api.service.nhs.uk"}, {"name": "NHSD-Correlation-ID", "value": "..rrt-4658976038220403375-a-geu2-24021-103322-1"}, {"name": "NHSD-Request-ID", "value": ""}, {"name": "User-Agent", "value": "Python/3.9 aiohttp/3.7.4.post0"}, {"name": "X-Forwarded-For", "value": "3.11.106.35"}, {"name": "X-Forwarded-Port", "value": "443"}, {"name": "X-Forwarded-Proto", "value": "https"}], "uRI": "/oauth2-pr-251/userinfo", "verb": "GET"}, {"ActionResult": "VariableAccess", "accessList": [{"Get": {"name": "proxy_quota_enabled", "value": "false"}}]}]}, {"id": "Execution", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "stepDefinition-async", "value": "false"}, {"name": "internal", "value": "false"}, {"name": "stepDefinition-type", "value": "raisefault"}, {"name": "expression", "value": "(ratelimit.QuotaPerProxy.failed equals true)"}, {"name": "type", "value": "RaiseFaultExecution"}, {"name": "enforcement", "value": "request"}, {"name": "stepDefinition-continueOnError", "value": "false"}, {"name": "expressionResult", "value": "false"}, {"name": "stepDefinition-displayName", "value": "RaiseFault.QuotaPerProxy"}, {"name": "stepDefinition-name", "value": "RaiseFault.QuotaPerProxy"}, {"name": "stepDefinition-enabled", "value": "true"}]}, "timestamp": "03-11-21 16:50:06:992"}, {"ActionResult": "RequestMessage", "headers": [{"name": "Accept", "value": "*/*"}, {"name": "Accept-Encoding", "value": "gzip,deflate"}, {"name": "Authorization", "value": "*****"}, {"name": "Host", "value": "internal-dev.api.service.nhs.uk"}, {"name": "NHSD-Correlation-ID", "value": "..rrt-4658976038220403375-a-geu2-24021-103322-1"}, {"name": "NHSD-Request-ID", "value": ""}, {"name": "User-Agent", "value": "Python/3.9 aiohttp/3.7.4.post0"}, {"name": "X-Forwarded-For", "value": "3.11.106.35"}, {"name": "X-Forwarded-Port", "value": "443"}, {"name": "X-Forwarded-Proto", "value": "https"}], "uRI": "/oauth2-pr-251/userinfo", "verb": "GET"}, {"ActionResult": "VariableAccess", "accessList": [{"Get": {"name": "ratelimit.QuotaPerProxy.failed"}}]}]}, {"id": "Paused", "results": []}, {"id": "FlowInfo", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "ratelimit.SpikeArrestPerProxy.allowed.count", "value": "300000"}, {"name": "ratelimit.SpikeArrestPerProxy.fault.name", "value": ""}, {"name": "ratelimit.SpikeArrestPerProxy.fault.cause", "value": ""}, {"name": "ratelimit.SpikeArrestPerProxy.expiry.time", "value": "0"}, {"name": "ratelimit.SpikeArrestPerProxy.datastore.fail.open", "value": "false"}, {"name": "ratelimit.SpikeArrestPerProxy.identifier", "value": "nhsd-nonprod@@@internal-dev@@@identity-service-pr-251@@@SpikeArrestPerProxy@@@nondistributed@@@_default"}, {"name": "ratelimit.SpikeArrestPerProxy.available.count", "value": "299997"}, {"name": "ratelimit.SpikeArrestPerProxy.used.count", "value": "3"}, {"name": "ratelimit.SpikeArrestPerProxy.total.exceed.count", "value": "0"}, {"name": "ratelimit.SpikeArrestPerProxy.class.available.count", "value": "0"}, {"name": "ratelimit.SpikeArrestPerProxy.class.total.exceed.count", "value": "0"}, {"name": "ratelimit.SpikeArrestPerProxy.exceed.count", "value": "0"}, {"name": "ratelimit.SpikeArrestPerProxy.class.exceed.count", "value": "0"}, {"name": "ratelimit.SpikeArrestPerProxy.failed", "value": "false"}, {"name": "ratelimit.SpikeArrestPerProxy.class.allowed.count", "value": "0"}, {"name": "ratelimit.SpikeArrestPerProxy.class.used.count", "value": "0"}]}, "timestamp": "03-11-21 16:50:06:992"}]}, {"id": "Execution", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "action", "value": "CONTINUE"}, {"name": "stepDefinition-async", "value": "false"}, {"name": "internal", "value": "false"}, {"name": "stepDefinition-type", "value": "SpikeArrest"}, {"name": "expression", "value": "(proxy_spikeArrest_enabled equals true)"}, {"name": "type", "value": "RateLimitExecution"}, {"name": "enforcement", "value": "request"}, {"name": "stepDefinition-continueOnError", "value": "false"}, {"name": "expressionResult", "value": "true"}, {"name": "stepDefinition-displayName", "value": "Per-proxy Spike Arrest"}, {"name": "stepDefinition-name", "value": "SpikeArrestPerProxy"}, {"name": "stepDefinition-enabled", "value": "true"}, {"name": "result", "value": "true"}]}, "timestamp": "03-11-21 16:50:06:992"}, {"ActionResult": "RequestMessage", "headers": [{"name": "Accept", "value": "*/*"}, {"name": "Accept-Encoding", "value": "gzip,deflate"}, {"name": "Authorization", "value": "*****"}, {"name": "Host", "value": "internal-dev.api.service.nhs.uk"}, {"name": "NHSD-Correlation-ID", "value": "..rrt-4658976038220403375-a-geu2-24021-103322-1"}, {"name": "NHSD-Request-ID", "value": ""}, {"name": "User-Agent", "value": "Python/3.9 aiohttp/3.7.4.post0"}, {"name": "X-Forwarded-For", "value": "3.11.106.35"}, {"name": "X-Forwarded-Port", "value": "443"}, {"name": "X-Forwarded-Proto", "value": "https"}], "uRI": "/oauth2-pr-251/userinfo", "verb": "GET"}, {"ActionResult": "VariableAccess", "accessList": [{"Get": {"name": "proxy_spikeArrest_ratelimit", "value": "300000pm"}}, {"Set": {"name": "apigee.metrics.policy.SpikeArrestPerProxy.timeTaken", "success": true, "value": "54701"}}]}]}, {"id": "Resumed", "results": []}, {"id": "Execution", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "stepDefinition-async", "value": "false"}, {"name": "internal", "value": "false"}, {"name": "stepDefinition-type", "value": "raisefault"}, {"name": "expression", "value": "(ratelimit.SpikeArrestPerProxy.failed equals true)"}, {"name": "type", "value": "RaiseFaultExecution"}, {"name": "enforcement", "value": "request"}, {"name": "stepDefinition-continueOnError", "value": "false"}, {"name": "expressionResult", "value": "false"}, {"name": "stepDefinition-displayName", "value": "RaiseFault.SpikeArrestPerProxy"}, {"name": "stepDefinition-name", "value": "RaiseFault.SpikeArrestPerProxy"}, {"name": "stepDefinition-enabled", "value": "true"}]}, "timestamp": "03-11-21 16:50:06:992"}, {"ActionResult": "RequestMessage", "headers": [{"name": "Accept", "value": "*/*"}, {"name": "Accept-Encoding", "value": "gzip,deflate"}, {"name": "Authorization", "value": "*****"}, {"name": "Host", "value": "internal-dev.api.service.nhs.uk"}, {"name": "NHSD-Correlation-ID", "value": "..rrt-4658976038220403375-a-geu2-24021-103322-1"}, {"name": "NHSD-Request-ID", "value": ""}, {"name": "User-Agent", "value": "Python/3.9 aiohttp/3.7.4.post0"}, {"name": "X-Forwarded-For", "value": "3.11.106.35"}, {"name": "X-Forwarded-Port", "value": "443"}, {"name": "X-Forwarded-Proto", "value": "https"}], "uRI": "/oauth2-pr-251/userinfo", "verb": "GET"}, {"ActionResult": "VariableAccess", "accessList": [{"Get": {"name": "proxy_spikeArrest_ratelimit", "value": "300000pm"}}, {"Set": {"name": "apigee.metrics.policy.SpikeArrestPerProxy.timeTaken", "success": true, "value": "54701"}}, {"Get": {"name": "ratelimit.SpikeArrestPerProxy.failed", "value": "false"}}]}]}, {"id": "FlowReturn", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "shared.flow.name", "value": "ApplyRateLimiting"}]}, "timestamp": "03-11-21 16:50:06:993"}]}, {"id": "Paused", "results": []}, {"id": "Execution", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "javascript-executionTime", "value": "0"}, {"name": "action", "value": "CONTINUE"}, {"name": "javascript-timeLimit", "value": "200"}, {"name": "stepDefinition-async", "value": "false"}, {"name": "internal", "value": "false"}, {"name": "stepDefinition-type", "value": "javascript"}, {"name": "javascript-name", "value": "check-apigee-access-token-attributes.js"}, {"name": "type", "value": "JavascriptStepExecution"}, {"name": "enforcement", "value": "request"}, {"name": "stepDefinition-continueOnError", "value": "false"}, {"name": "stepDefinition-displayName", "value": "Javascript.CheckApigeeAccessTokenAttributes"}, {"name": "stepDefinition-name", "value": "Javascript.CheckApigeeAccessTokenAttributes"}, {"name": "stepDefinition-enabled", "value": "true"}, {"name": "result", "value": "true"}]}, "timestamp": "03-11-21 16:50:06:993"}, {"ActionResult": "RequestMessage", "headers": [{"name": "Accept", "value": "*/*"}, {"name": "Accept-Encoding", "value": "gzip,deflate"}, {"name": "Authorization", "value": "*****"}, {"name": "Host", "value": "internal-dev.api.service.nhs.uk"}, {"name": "NHSD-Correlation-ID", "value": "..rrt-4658976038220403375-a-geu2-24021-103322-1"}, {"name": "NHSD-Request-ID", "value": ""}, {"name": "User-Agent", "value": "Python/3.9 aiohttp/3.7.4.post0"}, {"name": "X-Forwarded-For", "value": "3.11.106.35"}, {"name": "X-Forwarded-Port", "value": "443"}, {"name": "X-Forwarded-Proto", "value": "https"}], "uRI": "/oauth2-pr-251/userinfo", "verb": "GET"}, {"ActionResult": "VariableAccess", "accessList": [{"Get": {"name": "accesstoken.id_token-issuer", "value": "https://identity.ptl.api.platform.nhs.uk/auth/realms/cis2-mock"}}, {"Set": {"name": "idTokenIssuer", "success": true, "value": "nhsCis2"}}, {"Set": {"name": "InvalidIdTokenIssuer", "success": true, "value": "false"}}, {"Set": {"name": "apigee.metrics.policy.Javascript.CheckApigeeAccessTokenAttributes.timeTaken", "success": true, "value": "203332"}}]}]}, {"id": "Resumed", "results": []}, {"id": "Execution", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "stepDefinition-async", "value": "false"}, {"name": "internal", "value": "false"}, {"name": "stepDefinition-type", "value": "raisefault"}, {"name": "expression", "value": "((idTokenIssuer equals \"nhsLogin\") or ((InvalidIdTokenIssuer equals \"true\") or (accesstoken.external_access_token equals null)))"}, {"name": "type", "value": "RaiseFaultExecution"}, {"name": "enforcement", "value": "request"}, {"name": "stepDefinition-continueOnError", "value": "false"}, {"name": "expressionResult", "value": "false"}, {"name": "stepDefinition-displayName", "value": "RaiseFault.NotFound"}, {"name": "stepDefinition-name", "value": "RaiseFault.NotFound"}, {"name": "stepDefinition-enabled", "value": "true"}]}, "timestamp": "03-11-21 16:50:06:993"}, {"ActionResult": "RequestMessage", "headers": [{"name": "Accept", "value": "*/*"}, {"name": "Accept-Encoding", "value": "gzip,deflate"}, {"name": "Authorization", "value": "*****"}, {"name": "Host", "value": "internal-dev.api.service.nhs.uk"}, {"name": "NHSD-Correlation-ID", "value": "..rrt-4658976038220403375-a-geu2-24021-103322-1"}, {"name": "NHSD-Request-ID", "value": ""}, {"name": "User-Agent", "value": "Python/3.9 aiohttp/3.7.4.post0"}, {"name": "X-Forwarded-For", "value": "3.11.106.35"}, {"name": "X-Forwarded-Port", "value": "443"}, {"name": "X-Forwarded-Proto", "value": "https"}], "uRI": "/oauth2-pr-251/userinfo", "verb": "GET"}, {"ActionResult": "VariableAccess", "accessList": [{"Get": {"name": "accesstoken.id_token-issuer", "value": "https://identity.ptl.api.platform.nhs.uk/auth/realms/cis2-mock"}}, {"Set": {"name": "idTokenIssuer", "success": true, "value": "nhsCis2"}}, {"Set": {"name": "InvalidIdTokenIssuer", "success": true, "value": "false"}}, {"Set": {"name": "apigee.metrics.policy.Javascript.CheckApigeeAccessTokenAttributes.timeTaken", "success": true, "value": "203332"}}, {"Get": {"name": "idTokenIssuer", "value": "nhsCis2"}}, {"Get": {"name": "InvalidIdTokenIssuer", "value": "false"}}, {"Get": {"name": "accesstoken.external_access_token", "value": "eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICJKY3lCTU9LRDF2RnhJSDBoWVJ6Yktrc3V2d3QyNEl3dEhFSU5wS3JKelpZIn0.eyJleHAiOjE2MzU5NTg1MDUsImlhdCI6MTYzNTk1ODIwNSwiYXV0aF90aW1lIjoxNjM1OTU4MjA1LCJqdGkiOiI1ZTFlMDYyOC03ZDI3LTQyZWQtYjg5Mi03YjZjNTkxODRiYTEiLCJpc3MiOiJodHRwczovL2lkZW50aXR5LnB0bC5hcGkucGxhdGZvcm0ubmhzLnVrL2F1dGgvcmVhbG1zL2NpczItbW9jayIsInN1YiI6IjQyM2RmZjY3LWUwODUtNGIwNC04NDdmLTQ5MDE1NmJjNzY5MyIsInR5cCI6IkJlYXJlciIsImF6cCI6InRlc3QtY2xpZW50LTEiLCJzZXNzaW9uX3N0YXRlIjoiNGZmMzA0MDYtMTU3Ni00MmQwLTkxYTMtMmUwY2ZjMGYxODEwIiwiYWNyIjoiMSIsInNjb3BlIjoib3BlbmlkIHByb2ZpbGUgbmF0aW9uYWxyYmFjYWNjZXNzIGVtYWlsIiwic2lkIjoiNGZmMzA0MDYtMTU3Ni00MmQwLTkxYTMtMmUwY2ZjMGYxODEwIiwiYWNyIjoiQUFMM19BTlkiLCJhdWRpdFRyYWNraW5nSWQiOiI5MWY2OTRlNi0zNzQ5LTQyZmQtOTBiMC1ET05PVENIQU5HRS0xNTQ2MzkxIiwiYW1yIjpbIk4zX1NNQVJUQ0FSRCJdfQ.bW187J-UrvSkrFwL2GUFvmSFezvYUgh8onPJCyJpkVyYyOd4EMSwDi6Rqwi3ORo9iT44CkVynnH7K1GXgaG1GqNEDnEr8GkKhf5mUB50mrNnAKYw76z7ulpZrfbUuvaNZaECO6rAxl0CQw-Qjz3kVRvOkTnm5qffgnAx0oy71OVm5TohC3b2WKqWoUypIFevG_gp2Wp82hdz72Ix4tyQxyGuZGe8uJ25RHzOoT7nC72QG-IyLoM-w34TpNkZEhGWZaZ7Gfd1no5BWTBpEPaQrGYTE5tOeAG5oeLXIOj9oEIpD-HebtYuvvelo9fNGXKTMOJ5j-8A1e_jSeFsuLSsBw"}}]}]}, {"id": "Execution", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "action", "value": "CONTINUE"}, {"name": "stepDefinition-async", "value": "false"}, {"name": "internal", "value": "false"}, {"name": "stepDefinition-type", "value": "assignmessage"}, {"name": "type", "value": "AssignMessageExecution"}, {"name": "enforcement", "value": "request"}, {"name": "stepDefinition-continueOnError", "value": "false"}, {"name": "stepDefinition-displayName", "value": "AssignMessage.SetAuthorizationHeader"}, {"name": "stepDefinition-name", "value": "AssignMessage.SetAuthorizationHeader"}, {"name": "stepDefinition-enabled", "value": "true"}, {"name": "result", "value": "true"}]}, "timestamp": "03-11-21 16:50:06:993"}, {"ActionResult": "RequestMessage", "headers": [{"name": "Accept", "value": "*/*"}, {"name": "Accept-Encoding", "value": "gzip,deflate"}, {"name": "Authorization", "value": "*****"}, {"name": "Host", "value": "internal-dev.api.service.nhs.uk"}, {"name": "NHSD-Correlation-ID", "value": "..rrt-4658976038220403375-a-geu2-24021-103322-1"}, {"name": "NHSD-Request-ID", "value": ""}, {"name": "User-Agent", "value": "Python/3.9 aiohttp/3.7.4.post0"}, {"name": "X-Forwarded-For", "value": "3.11.106.35"}, {"name": "X-Forwarded-Port", "value": "443"}, {"name": "X-Forwarded-Proto", "value": "https"}], "uRI": "/oauth2-pr-251/userinfo", "verb": "GET"}, {"ActionResult": "VariableAccess", "accessList": [{"Get": {"name": "accesstoken.external_access_token", "value": "eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICJKY3lCTU9LRDF2RnhJSDBoWVJ6Yktrc3V2d3QyNEl3dEhFSU5wS3JKelpZIn0.eyJleHAiOjE2MzU5NTg1MDUsImlhdCI6MTYzNTk1ODIwNSwiYXV0aF90aW1lIjoxNjM1OTU4MjA1LCJqdGkiOiI1ZTFlMDYyOC03ZDI3LTQyZWQtYjg5Mi03YjZjNTkxODRiYTEiLCJpc3MiOiJodHRwczovL2lkZW50aXR5LnB0bC5hcGkucGxhdGZvcm0ubmhzLnVrL2F1dGgvcmVhbG1zL2NpczItbW9jayIsInN1YiI6IjQyM2RmZjY3LWUwODUtNGIwNC04NDdmLTQ5MDE1NmJjNzY5MyIsInR5cCI6IkJlYXJlciIsImF6cCI6InRlc3QtY2xpZW50LTEiLCJzZXNzaW9uX3N0YXRlIjoiNGZmMzA0MDYtMTU3Ni00MmQwLTkxYTMtMmUwY2ZjMGYxODEwIiwiYWNyIjoiMSIsInNjb3BlIjoib3BlbmlkIHByb2ZpbGUgbmF0aW9uYWxyYmFjYWNjZXNzIGVtYWlsIiwic2lkIjoiNGZmMzA0MDYtMTU3Ni00MmQwLTkxYTMtMmUwY2ZjMGYxODEwIiwiYWNyIjoiQUFMM19BTlkiLCJhdWRpdFRyYWNraW5nSWQiOiI5MWY2OTRlNi0zNzQ5LTQyZmQtOTBiMC1ET05PVENIQU5HRS0xNTQ2MzkxIiwiYW1yIjpbIk4zX1NNQVJUQ0FSRCJdfQ.bW187J-UrvSkrFwL2GUFvmSFezvYUgh8onPJCyJpkVyYyOd4EMSwDi6Rqwi3ORo9iT44CkVynnH7K1GXgaG1GqNEDnEr8GkKhf5mUB50mrNnAKYw76z7ulpZrfbUuvaNZaECO6rAxl0CQw-Qjz3kVRvOkTnm5qffgnAx0oy71OVm5TohC3b2WKqWoUypIFevG_gp2Wp82hdz72Ix4tyQxyGuZGe8uJ25RHzOoT7nC72QG-IyLoM-w34TpNkZEhGWZaZ7Gfd1no5BWTBpEPaQrGYTE5tOeAG5oeLXIOj9oEIpD-HebtYuvvelo9fNGXKTMOJ5j-8A1e_jSeFsuLSsBw"}}, {"Set": {"name": "message.header.Authorization", "success": true, "value": "Bearer eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICJKY3lCTU9LRDF2RnhJSDBoWVJ6Yktrc3V2d3QyNEl3dEhFSU5wS3JKelpZIn0.eyJleHAiOjE2MzU5NTg1MDUsImlhdCI6MTYzNTk1ODIwNSwiYXV0aF90aW1lIjoxNjM1OTU4MjA1LCJqdGkiOiI1ZTFlMDYyOC03ZDI3LTQyZWQtYjg5Mi03YjZjNTkxODRiYTEiLCJpc3MiOiJodHRwczovL2lkZW50aXR5LnB0bC5hcGkucGxhdGZvcm0ubmhzLnVrL2F1dGgvcmVhbG1zL2NpczItbW9jayIsInN1YiI6IjQyM2RmZjY3LWUwODUtNGIwNC04NDdmLTQ5MDE1NmJjNzY5MyIsInR5cCI6IkJlYXJlciIsImF6cCI6InRlc3QtY2xpZW50LTEiLCJzZXNzaW9uX3N0YXRlIjoiNGZmMzA0MDYtMTU3Ni00MmQwLTkxYTMtMmUwY2ZjMGYxODEwIiwiYWNyIjoiMSIsInNjb3BlIjoib3BlbmlkIHByb2ZpbGUgbmF0aW9uYWxyYmFjYWNjZXNzIGVtYWlsIiwic2lkIjoiNGZmMzA0MDYtMTU3Ni00MmQwLTkxYTMtMmUwY2ZjMGYxODEwIiwiYWNyIjoiQUFMM19BTlkiLCJhdWRpdFRyYWNraW5nSWQiOiI5MWY2OTRlNi0zNzQ5LTQyZmQtOTBiMC1ET05PVENIQU5HRS0xNTQ2MzkxIiwiYW1yIjpbIk4zX1NNQVJUQ0FSRCJdfQ.bW187J-UrvSkrFwL2GUFvmSFezvYUgh8onPJCyJpkVyYyOd4EMSwDi6Rqwi3ORo9iT44CkVynnH7K1GXgaG1GqNEDnEr8GkKhf5mUB50mrNnAKYw76z7ulpZrfbUuvaNZaECO6rAxl0CQw-Qjz3kVRvOkTnm5qffgnAx0oy71OVm5TohC3b2WKqWoUypIFevG_gp2Wp82hdz72Ix4tyQxyGuZGe8uJ25RHzOoT7nC72QG-IyLoM-w34TpNkZEhGWZaZ7Gfd1no5BWTBpEPaQrGYTE5tOeAG5oeLXIOj9oEIpD-HebtYuvvelo9fNGXKTMOJ5j-8A1e_jSeFsuLSsBw"}}, {"Set": {"name": "apigee.metrics.policy.AssignMessage.SetAuthorizationHeader.timeTaken", "success": true, "value": "16556"}}]}]}, {"id": "FlowInfo", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "proxy.flow.name", "value": "PostFlow"}]}, "timestamp": "03-11-21 16:50:06:993"}]}, {"id": "FlowInfo", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "current.flow.name", "value": "PostFlow"}]}, "timestamp": "03-11-21 16:50:06:993"}]}, {"id": "Condition", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "ExpressionResult", "value": "false"}, {"name": "Expression", "value": "(proxy.pathsuffix matches /_ping and ((request.verb equals \"GET\") or (request.verb equals \"HEAD\")))"}, {"name": "Tree", "value": "TARGET_SELECTOR"}]}, "timestamp": "03-11-21 16:50:06:993"}, {"ActionResult": "VariableAccess", "accessList": [{"Get": {"name": "proxy.pathsuffix", "value": "/userinfo"}}]}]}, {"id": "Condition", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "ExpressionResult", "value": "true"}, {"name": "Expression", "value": "(proxy.pathsuffix matches /userinfo and (request.verb equals \"GET\"))"}, {"name": "Tree", "value": "TARGET_SELECTOR"}]}, "timestamp": "03-11-21 16:50:06:993"}, {"ActionResult": "VariableAccess", "accessList": [{"Get": {"name": "proxy.pathsuffix", "value": "/userinfo"}}, {"Get": {"name": "request.verb", "value": "GET"}}]}]}, {"id": "FlowInfo", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "route.name", "value": "userinfoRoute"}, {"name": "route.target", "value": "identity-server-userinfo"}]}, "timestamp": "03-11-21 16:50:06:993"}]}, {"id": "FlowInfo", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "target.basepath.with.query", "value": "/auth/realms/cis2-mock/protocol/openid-connect"}, {"name": "target.copy.queryparams", "value": "true"}, {"name": "target.copy.pathsuffix", "value": "true"}, {"name": "target.basepath", "value": "{identity-service-config.cis2.userinfo_path}"}, {"name": "target.name", "value": "identity-server-userinfo"}]}, "timestamp": "03-11-21 16:50:06:993"}]}, {"id": "FlowInfo", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "targetURL", "value": "-NA-"}, {"name": "targetBasePath", "value": "{identity-service-config.cis2.userinfo_path}"}, {"name": "targetRequestSender", "value": "LBTargetRequestSender"}, {"name": "targetEndpoint", "value": "identity-server-userinfo{Organization=nhsd-nonprodEnvironment=internal-dev,Application=identity-service-pr-251__13}"}]}, "timestamp": "03-11-21 16:50:06:993"}]}, {"id": "StateChange", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "To", "value": "TARGET_REQ_FLOW"}, {"name": "From", "value": "PROXY_REQ_FLOW"}]}, "timestamp": "03-11-21 16:50:06:993"}, {"ActionResult": "RequestMessage", "headers": [{"name": "Accept", "value": "*/*"}, {"name": "Accept-Encoding", "value": "gzip,deflate"}, {"name": "Authorization", "value": "*****"}, {"name": "Host", "value": "internal-dev.api.service.nhs.uk"}, {"name": "NHSD-Correlation-ID", "value": "..rrt-4658976038220403375-a-geu2-24021-103322-1"}, {"name": "NHSD-Request-ID", "value": ""}, {"name": "User-Agent", "value": "Python/3.9 aiohttp/3.7.4.post0"}, {"name": "X-Forwarded-For", "value": "3.11.106.35"}, {"name": "X-Forwarded-Port", "value": "443"}, {"name": "X-Forwarded-Proto", "value": "https"}], "uRI": "/oauth2-pr-251/userinfo", "verb": "GET"}]}, {"id": "Condition", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "ExpressionResult", "value": "true"}, {"name": "Expression", "value": "(\"identity-server-userinfo\" equals target.name)"}, {"name": "Tree", "value": "TARGET_identity-server-userinfo"}]}, "timestamp": "03-11-21 16:50:06:993"}, {"ActionResult": "VariableAccess", "accessList": [{"Get": {"name": "target.name", "value": "identity-server-userinfo"}}]}]}, {"id": "FlowInfo", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "target.flow.name", "value": "PreFlow"}]}, "timestamp": "03-11-21 16:50:06:993"}]}, {"id": "FlowInfo", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "current.flow.name", "value": "PreFlow"}]}, "timestamp": "03-11-21 16:50:06:993"}]}, {"id": "FlowInfo", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "target.flow.name", "value": "PostFlow"}]}, "timestamp": "03-11-21 16:50:06:993"}]}, {"id": "FlowInfo", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "current.flow.name", "value": "PostFlow"}]}, "timestamp": "03-11-21 16:50:06:993"}]}, {"id": "Execution", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "type", "value": "FlowHookAction"}]}, "timestamp": "03-11-21 16:50:06:993"}, {"ActionResult": "RequestMessage", "headers": [{"name": "Accept", "value": "*/*"}, {"name": "Accept-Encoding", "value": "gzip,deflate"}, {"name": "Authorization", "value": "*****"}, {"name": "Host", "value": "internal-dev.api.service.nhs.uk"}, {"name": "NHSD-Correlation-ID", "value": "..rrt-4658976038220403375-a-geu2-24021-103322-1"}, {"name": "NHSD-Request-ID", "value": ""}, {"name": "User-Agent", "value": "Python/3.9 aiohttp/3.7.4.post0"}, {"name": "X-Forwarded-For", "value": "3.11.106.35"}, {"name": "X-Forwarded-Port", "value": "443"}, {"name": "X-Forwarded-Proto", "value": "https"}], "uRI": "/oauth2-pr-251/userinfo", "verb": "GET"}, {"ActionResult": "VariableAccess", "accessList": []}]}, {"id": "FlowCallout", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "shared.flow.name", "value": "PreTargetFlowHook->PreTargetSharedFlow"}]}, "timestamp": "03-11-21 16:50:06:993"}]}, {"id": "Execution", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "action", "value": "CONTINUE"}, {"name": "stepDefinition-async", "value": "false"}, {"name": "internal", "value": "false"}, {"name": "stepDefinition-type", "value": "assignmessage"}, {"name": "type", "value": "AssignMessageExecution"}, {"name": "enforcement", "value": "request"}, {"name": "stepDefinition-continueOnError", "value": "false"}, {"name": "stepDefinition-displayName", "value": "AssignMessage.RemoveApimServiceHeader"}, {"name": "stepDefinition-name", "value": "AssignMessage.RemoveApimServiceHeader"}, {"name": "stepDefinition-enabled", "value": "true"}, {"name": "result", "value": "true"}]}, "timestamp": "03-11-21 16:50:06:993"}, {"ActionResult": "RequestMessage", "headers": [{"name": "Accept", "value": "*/*"}, {"name": "Accept-Encoding", "value": "gzip,deflate"}, {"name": "Authorization", "value": "*****"}, {"name": "Host", "value": "internal-dev.api.service.nhs.uk"}, {"name": "NHSD-Correlation-ID", "value": "..rrt-4658976038220403375-a-geu2-24021-103322-1"}, {"name": "NHSD-Request-ID", "value": ""}, {"name": "User-Agent", "value": "Python/3.9 aiohttp/3.7.4.post0"}, {"name": "X-Forwarded-For", "value": "3.11.106.35"}, {"name": "X-Forwarded-Port", "value": "443"}, {"name": "X-Forwarded-Proto", "value": "https"}], "uRI": "/oauth2-pr-251/userinfo", "verb": "GET"}, {"ActionResult": "VariableAccess", "accessList": [{"Set": {"name": "apigee.metrics.policy.AssignMessage.RemoveApimServiceHeader.timeTaken", "success": true, "value": "4954"}}]}]}, {"id": "FlowReturn", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "shared.flow.name", "value": "PreTargetFlowHook->PreTargetSharedFlow"}]}, "timestamp": "03-11-21 16:50:06:993"}]}, {"id": "FlowInfo", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "loadbalancing.targetserver", "value": "cis2-keycloak"}, {"name": "loadbalancing.isfallback", "value": "false"}, {"name": "loadbalancing.failedservers", "value": "[]"}]}, "timestamp": "03-11-21 16:50:06:993"}]}, {"id": "Paused", "results": []}, {"id": "Resumed", "results": []}, {"id": "FlowInfo", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "targetendpoint_identity-server-userinfo.isFromClientPool", "value": "false"}, {"name": "targetendpoint_identity-server-userinfo.totalConnectionTimeMs", "value": "14"}, {"name": "targetendpoint_identity-server-userinfo.socketAgeMs", "value": "14"}, {"name": "targetendpoint_identity-server-userinfo.connectionTlsHandshakeTimeMs", "value": "10"}, {"name": "targetendpoint_identity-server-userinfo.socketUseCount", "value": "1"}, {"name": "targetendpoint_identity-server-userinfo.resolvedAddress", "value": "18.134.53.62"}, {"name": "targetendpoint_identity-server-userinfo.tlsHandshakeStatus", "value": "COMPLETED"}, {"name": "targetendpoint_identity-server-userinfo.connectionStatus", "value": "CONNECTED"}, {"name": "targetendpoint_identity-server-userinfo.isTlsEnabled", "value": "true"}, {"name": "targetendpoint_identity-server-userinfo.isHttpClientCached", "value": "true"}]}, "timestamp": "03-11-21 16:50:07:015"}]}, {"id": "StateChange", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "To", "value": "REQ_SENT"}, {"name": "From", "value": "TARGET_REQ_FLOW"}]}, "timestamp": "03-11-21 16:50:07:015"}, {"ActionResult": "ResponseMessage", "headers": [{"name": "Cache-Control", "value": "no-cache"}, {"name": "Connection", "value": "keep-alive"}, {"name": "Content-Length", "value": "46"}, {"name": "Content-Type", "value": "application/json"}, {"name": "Date", "value": "Wed, 03 Nov 2021 16:50:07 GMT"}, {"name": "Referrer-Policy", "value": "no-referrer"}, {"name": "Strict-Transport-Security", "value": "max-age=31536000; includeSubDomains"}, {"name": "X-Content-Type-Options", "value": "nosniff"}, {"name": "X-Frame-Options", "value": "SAMEORIGIN"}, {"name": "X-XSS-Protection", "value": "1; mode=block"}], "reasonPhrase": "OK", "statusCode": "200"}]}, {"id": "Paused", "results": []}, {"id": "Resumed", "results": []}, {"id": "StateChange", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "To", "value": "RESP_START"}, {"name": "From", "value": "REQ_SENT"}]}, "timestamp": "03-11-21 16:50:07:015"}, {"ActionResult": "ResponseMessage", "headers": [{"name": "Cache-Control", "value": "no-cache"}, {"name": "Connection", "value": "keep-alive"}, {"name": "Content-Length", "value": "46"}, {"name": "Content-Type", "value": "application/json"}, {"name": "Date", "value": "Wed, 03 Nov 2021 16:50:07 GMT"}, {"name": "Referrer-Policy", "value": "no-referrer"}, {"name": "Strict-Transport-Security", "value": "max-age=31536000; includeSubDomains"}, {"name": "X-Content-Type-Options", "value": "nosniff"}, {"name": "X-Frame-Options", "value": "SAMEORIGIN"}, {"name": "X-XSS-Protection", "value": "1; mode=block"}], "reasonPhrase": "OK", "statusCode": "200"}]}, {"id": "Condition", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "ExpressionResult", "value": "true"}, {"name": "Expression", "value": "(\"identity-server-userinfo\" equals target.name)"}, {"name": "Tree", "value": "TARGET_identity-server-userinfo"}]}, "timestamp": "03-11-21 16:50:07:016"}, {"ActionResult": "VariableAccess", "accessList": [{"Get": {"name": "target.name", "value": "identity-server-userinfo"}}]}]}, {"id": "Paused", "results": []}, {"id": "Resumed", "results": []}, {"id": "FlowInfo", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "targetendpoint_identity-server-userinfo.isFromClientPool", "value": "false"}, {"name": "targetendpoint_identity-server-userinfo.totalConnectionTimeMs", "value": "14"}, {"name": "targetendpoint_identity-server-userinfo.socketAgeMs", "value": "22"}, {"name": "targetendpoint_identity-server-userinfo.connectionTlsHandshakeTimeMs", "value": "10"}, {"name": "targetendpoint_identity-server-userinfo.socketUseCount", "value": "1"}, {"name": "targetendpoint_identity-server-userinfo.resolvedAddress", "value": "18.134.53.62"}, {"name": "targetendpoint_identity-server-userinfo.tlsHandshakeStatus", "value": "COMPLETED"}, {"name": "targetendpoint_identity-server-userinfo.connectionStatus", "value": "CONNECTED"}, {"name": "targetendpoint_identity-server-userinfo.isTlsEnabled", "value": "true"}, {"name": "targetendpoint_identity-server-userinfo.isHttpClientCached", "value": "true"}]}, "timestamp": "03-11-21 16:50:07:016"}]}, {"id": "StateChange", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "To", "value": "TARGET_RESP_FLOW"}, {"name": "From", "value": "RESP_START"}]}, "timestamp": "03-11-21 16:50:07:016"}, {"ActionResult": "ResponseMessage", "content": "{\"sub\":\"423dff67-e085-4b04-847f-490156bc7693\"}", "headers": [{"name": "Cache-Control", "value": "no-cache"}, {"name": "Connection", "value": "keep-alive"}, {"name": "Content-Length", "value": "46"}, {"name": "Content-Type", "value": "application/json"}, {"name": "Date", "value": "Wed, 03 Nov 2021 16:50:07 GMT"}, {"name": "Referrer-Policy", "value": "no-referrer"}, {"name": "Strict-Transport-Security", "value": "max-age=31536000; includeSubDomains"}, {"name": "X-Content-Type-Options", "value": "nosniff"}, {"name": "X-Frame-Options", "value": "SAMEORIGIN"}, {"name": "X-XSS-Protection", "value": "1; mode=block"}], "reasonPhrase": "OK", "statusCode": "200"}]}, {"id": "Condition", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "ExpressionResult", "value": "true"}, {"name": "Expression", "value": "(\"identity-server-userinfo\" equals target.name)"}, {"name": "Tree", "value": "TARGET_identity-server-userinfo"}]}, "timestamp": "03-11-21 16:50:07:016"}, {"ActionResult": "VariableAccess", "accessList": [{"Get": {"name": "target.name", "value": "identity-server-userinfo"}}]}]}, {"id": "FlowInfo", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "target.flow.name", "value": "PreFlow"}]}, "timestamp": "03-11-21 16:50:07:016"}]}, {"id": "FlowInfo", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "current.flow.name", "value": "PreFlow"}]}, "timestamp": "03-11-21 16:50:07:016"}]}, {"id": "FlowInfo", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "target.flow.name", "value": "PostFlow"}]}, "timestamp": "03-11-21 16:50:07:016"}]}, {"id": "FlowInfo", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "current.flow.name", "value": "PostFlow"}]}, "timestamp": "03-11-21 16:50:07:016"}]}, {"id": "StateChange", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "To", "value": "PROXY_RESP_FLOW"}, {"name": "From", "value": "TARGET_RESP_FLOW"}]}, "timestamp": "03-11-21 16:50:07:016"}, {"ActionResult": "ResponseMessage", "content": "{\"sub\":\"423dff67-e085-4b04-847f-490156bc7693\"}", "headers": [{"name": "Cache-Control", "value": "no-cache"}, {"name": "Connection", "value": "keep-alive"}, {"name": "Content-Length", "value": "46"}, {"name": "Content-Type", "value": "application/json"}, {"name": "Date", "value": "Wed, 03 Nov 2021 16:50:07 GMT"}, {"name": "Referrer-Policy", "value": "no-referrer"}, {"name": "Strict-Transport-Security", "value": "max-age=31536000; includeSubDomains"}, {"name": "X-Content-Type-Options", "value": "nosniff"}, {"name": "X-Frame-Options", "value": "SAMEORIGIN"}, {"name": "X-XSS-Protection", "value": "1; mode=block"}], "reasonPhrase": "OK", "statusCode": "200"}]}, {"id": "Condition", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "ExpressionResult", "value": "true"}, {"name": "Expression", "value": "(\"default\" equals proxy.name)"}, {"name": "Tree", "value": "PROXY_default"}]}, "timestamp": "03-11-21 16:50:07:016"}, {"ActionResult": "VariableAccess", "accessList": [{"Get": {"name": "proxy.name", "value": "default"}}]}]}, {"id": "FlowInfo", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "proxy.flow.name", "value": "PreFlow"}]}, "timestamp": "03-11-21 16:50:07:016"}]}, {"id": "FlowInfo", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "current.flow.name", "value": "PreFlow"}]}, "timestamp": "03-11-21 16:50:07:016"}]}, {"id": "Condition", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "ExpressionResult", "value": "false"}, {"name": "Expression", "value": "(proxy.pathsuffix matches /_ping and ((request.verb equals \"GET\") or (request.verb equals \"HEAD\")))"}, {"name": "Tree", "value": "AddPayloadToPing_RESPONSE_FLOW"}]}, "timestamp": "03-11-21 16:50:07:016"}, {"ActionResult": "VariableAccess", "accessList": [{"Get": {"name": "proxy.pathsuffix", "value": "/userinfo"}}]}]}, {"id": "Condition", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "ExpressionResult", "value": "false"}, {"name": "Expression", "value": "(proxy.pathsuffix matches /authorize and (request.verb equals \"GET\"))"}, {"name": "Tree", "value": "Flow.GetAuthorization_RESPONSE_FLOW"}]}, "timestamp": "03-11-21 16:50:07:016"}, {"ActionResult": "VariableAccess", "accessList": [{"Get": {"name": "proxy.pathsuffix", "value": "/userinfo"}}]}]}, {"id": "Condition", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "ExpressionResult", "value": "false"}, {"name": "Expression", "value": "(proxy.pathsuffix matches /token and ((request.verb equals \"POST\") and ((request.formparam.grant_type equals \"client_credentials\") and (request.formparam.subject_token_type not equals \"urn:ietf:params:oauth:token-type:id_token\"))))"}, {"name": "Tree", "value": "Flow.PostTokenClientCredentials_RESPONSE_FLOW"}]}, "timestamp": "03-11-21 16:50:07:016"}, {"ActionResult": "VariableAccess", "accessList": [{"Get": {"name": "proxy.pathsuffix", "value": "/userinfo"}}]}]}, {"id": "Condition", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "ExpressionResult", "value": "false"}, {"name": "Expression", "value": "(proxy.pathsuffix matches /token and ((request.verb equals \"POST\") and ((request.formparam.subject_token_type equals \"urn:ietf:params:oauth:token-type:id_token\") and (apim.feature_toggles.enable-token-exchange equals true))))"}, {"name": "Tree", "value": "Flow.PostTokenTokenExchange_RESPONSE_FLOW"}]}, "timestamp": "03-11-21 16:50:07:016"}, {"ActionResult": "VariableAccess", "accessList": [{"Get": {"name": "proxy.pathsuffix", "value": "/userinfo"}}]}]}, {"id": "Condition", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "ExpressionResult", "value": "false"}, {"name": "Expression", "value": "(proxy.pathsuffix matches /backchannel_logout and (request.verb equals \"POST\"))"}, {"name": "Tree", "value": "Flow.BackChannelLogout_RESPONSE_FLOW"}]}, "timestamp": "03-11-21 16:50:07:016"}, {"ActionResult": "VariableAccess", "accessList": [{"Get": {"name": "proxy.pathsuffix", "value": "/userinfo"}}]}]}, {"id": "Condition", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "ExpressionResult", "value": "false"}, {"name": "Expression", "value": "(proxy.pathsuffix matches /token and ((request.verb equals \"POST\") and (request.formparam.grant_type equals \"authorization_code\")))"}, {"name": "Tree", "value": "Flow.PostTokenAuthorizationCode_RESPONSE_FLOW"}]}, "timestamp": "03-11-21 16:50:07:016"}, {"ActionResult": "VariableAccess", "accessList": [{"Get": {"name": "proxy.pathsuffix", "value": "/userinfo"}}]}]}, {"id": "Condition", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "ExpressionResult", "value": "false"}, {"name": "Expression", "value": "(proxy.pathsuffix matches /token and ((request.verb equals \"POST\") and (request.formparam.grant_type equals \"refresh_token\")))"}, {"name": "Tree", "value": "Flow.PostRefreshToken_RESPONSE_FLOW"}]}, "timestamp": "03-11-21 16:50:07:016"}, {"ActionResult": "VariableAccess", "accessList": [{"Get": {"name": "proxy.pathsuffix", "value": "/userinfo"}}]}]}, {"id": "Condition", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "ExpressionResult", "value": "false"}, {"name": "Expression", "value": "(proxy.pathsuffix matches /callback and (request.verb equals \"GET\"))"}, {"name": "Tree", "value": "Flow.GetCallback_RESPONSE_FLOW"}]}, "timestamp": "03-11-21 16:50:07:016"}, {"ActionResult": "VariableAccess", "accessList": [{"Get": {"name": "proxy.pathsuffix", "value": "/userinfo"}}]}]}, {"id": "Condition", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "ExpressionResult", "value": "true"}, {"name": "Expression", "value": "(proxy.pathsuffix matches /userinfo and (request.verb equals \"GET\"))"}, {"name": "Tree", "value": "Flow.GetUserInfo_RESPONSE_FLOW"}]}, "timestamp": "03-11-21 16:50:07:016"}, {"ActionResult": "VariableAccess", "accessList": [{"Get": {"name": "proxy.pathsuffix", "value": "/userinfo"}}, {"Get": {"name": "request.verb", "value": "GET"}}]}]}, {"id": "FlowInfo", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "proxy.flow.name", "value": "Flow.GetUserInfo"}, {"name": "proxy.flow.description", "value": ""}]}, "timestamp": "03-11-21 16:50:07:016"}]}, {"id": "FlowInfo", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "current.flow.name", "value": "Flow.GetUserInfo"}, {"name": "current.flow.description", "value": ""}]}, "timestamp": "03-11-21 16:50:07:016"}]}, {"id": "FlowInfo", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "proxy.flow.name", "value": "PostFlow"}]}, "timestamp": "03-11-21 16:50:07:016"}]}, {"id": "FlowInfo", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "current.flow.name", "value": "PostFlow"}]}, "timestamp": "03-11-21 16:50:07:016"}]}, {"id": "StateChange", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "To", "value": "RESP_SENT"}, {"name": "From", "value": "PROXY_RESP_FLOW"}]}, "timestamp": "03-11-21 16:50:07:016"}, {"ActionResult": "ResponseMessage", "content": "{\"sub\":\"423dff67-e085-4b04-847f-490156bc7693\"}", "headers": [{"name": "Cache-Control", "value": "no-cache"}, {"name": "Connection", "value": "keep-alive"}, {"name": "Content-Length", "value": "46"}, {"name": "Content-Type", "value": "application/json"}, {"name": "Date", "value": "Wed, 03 Nov 2021 16:50:07 GMT"}, {"name": "Referrer-Policy", "value": "no-referrer"}, {"name": "Strict-Transport-Security", "value": "max-age=31536000; includeSubDomains"}, {"name": "X-Content-Type-Options", "value": "nosniff"}, {"name": "X-Frame-Options", "value": "SAMEORIGIN"}, {"name": "X-XSS-Protection", "value": "1; mode=block"}], "reasonPhrase": "OK", "statusCode": "200"}]}, {"id": "Execution", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "type", "value": "FlowHookAction"}]}, "timestamp": "03-11-21 16:50:07:016"}, {"ActionResult": "ResponseMessage", "content": "{\"sub\":\"423dff67-e085-4b04-847f-490156bc7693\"}", "headers": [{"name": "Cache-Control", "value": "no-cache"}, {"name": "Connection", "value": "keep-alive"}, {"name": "Content-Length", "value": "46"}, {"name": "Content-Type", "value": "application/json"}, {"name": "Date", "value": "Wed, 03 Nov 2021 16:50:07 GMT"}, {"name": "Referrer-Policy", "value": "no-referrer"}, {"name": "Strict-Transport-Security", "value": "max-age=31536000; includeSubDomains"}, {"name": "X-Content-Type-Options", "value": "nosniff"}, {"name": "X-Frame-Options", "value": "SAMEORIGIN"}, {"name": "X-XSS-Protection", "value": "1; mode=block"}], "reasonPhrase": "OK", "statusCode": "200"}, {"ActionResult": "VariableAccess", "accessList": []}]}, {"id": "FlowCallout", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "shared.flow.name", "value": "PostProxyFlowHook->PostProxySharedFlow"}]}, "timestamp": "03-11-21 16:50:07:016"}]}, {"id": "Execution", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "action", "value": "CONTINUE"}, {"name": "stepDefinition-async", "value": "false"}, {"name": "internal", "value": "false"}, {"name": "stepDefinition-type", "value": "assignmessage"}, {"name": "type", "value": "AssignMessageExecution"}, {"name": "enforcement", "value": "request"}, {"name": "stepDefinition-continueOnError", "value": "true"}, {"name": "stepDefinition-displayName", "value": "AssignMessage.SetHSTSHeader"}, {"name": "stepDefinition-name", "value": "AssignMessage.SetHSTSHeader"}, {"name": "stepDefinition-enabled", "value": "true"}, {"name": "result", "value": "true"}]}, "timestamp": "03-11-21 16:50:07:016"}, {"ActionResult": "ResponseMessage", "content": "{\"sub\":\"423dff67-e085-4b04-847f-490156bc7693\"}", "headers": [{"name": "Cache-Control", "value": "no-cache"}, {"name": "Connection", "value": "keep-alive"}, {"name": "Content-Length", "value": "46"}, {"name": "Content-Type", "value": "application/json"}, {"name": "Date", "value": "Wed, 03 Nov 2021 16:50:07 GMT"}, {"name": "Referrer-Policy", "value": "no-referrer"}, {"name": "Strict-Transport-Security", "value": "max-age=864000; includeSubDomains"}, {"name": "X-Content-Type-Options", "value": "nosniff"}, {"name": "X-Frame-Options", "value": "SAMEORIGIN"}, {"name": "X-XSS-Protection", "value": "1; mode=block"}], "reasonPhrase": "OK", "statusCode": "200"}, {"ActionResult": "VariableAccess", "accessList": [{"Set": {"name": "message.header.Strict-Transport-Security", "success": true, "value": "max-age=864000; includeSubDomains"}}, {"Set": {"name": "apigee.metrics.policy.AssignMessage.SetHSTSHeader.timeTaken", "success": true, "value": "16388"}}]}]}, {"id": "Execution", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "stepDefinition-async", "value": "false"}, {"name": "internal", "value": "false"}, {"name": "stepDefinition-type", "value": "assignmessage"}, {"name": "expression", "value": "original-request-details.header.X-Correlation-ID matches regular expression .+"}, {"name": "type", "value": "AssignMessageExecution"}, {"name": "enforcement", "value": "request"}, {"name": "stepDefinition-continueOnError", "value": "false"}, {"name": "expressionResult", "value": "false"}, {"name": "stepDefinition-displayName", "value": "AssignMessage.Mirror.CorrelationID"}, {"name": "stepDefinition-name", "value": "AssignMessage.Mirror.CorrelationID"}, {"name": "stepDefinition-enabled", "value": "true"}]}, "timestamp": "03-11-21 16:50:07:016"}, {"ActionResult": "ResponseMessage", "content": "{\"sub\":\"423dff67-e085-4b04-847f-490156bc7693\"}", "headers": [{"name": "Cache-Control", "value": "no-cache"}, {"name": "Connection", "value": "keep-alive"}, {"name": "Content-Length", "value": "46"}, {"name": "Content-Type", "value": "application/json"}, {"name": "Date", "value": "Wed, 03 Nov 2021 16:50:07 GMT"}, {"name": "Referrer-Policy", "value": "no-referrer"}, {"name": "Strict-Transport-Security", "value": "max-age=864000; includeSubDomains"}, {"name": "X-Content-Type-Options", "value": "nosniff"}, {"name": "X-Frame-Options", "value": "SAMEORIGIN"}, {"name": "X-XSS-Protection", "value": "1; mode=block"}], "reasonPhrase": "OK", "statusCode": "200"}, {"ActionResult": "VariableAccess", "accessList": [{"Set": {"name": "message.header.Strict-Transport-Security", "success": true, "value": "max-age=864000; includeSubDomains"}}, {"Set": {"name": "apigee.metrics.policy.AssignMessage.SetHSTSHeader.timeTaken", "success": true, "value": "16388"}}, {"Get": {"name": "original-request-details.header.X-Correlation-ID"}}]}]}, {"id": "Execution", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "stepDefinition-async", "value": "false"}, {"name": "internal", "value": "false"}, {"name": "stepDefinition-type", "value": "assignmessage"}, {"name": "expression", "value": "((flag.custom-header-x-request-id not equals true) and original-request-details.header.X-Request-ID matches regular expression .+)"}, {"name": "type", "value": "AssignMessageExecution"}, {"name": "enforcement", "value": "request"}, {"name": "stepDefinition-continueOnError", "value": "false"}, {"name": "expressionResult", "value": "false"}, {"name": "stepDefinition-displayName", "value": "AssignMessage.Mirror.RequestID"}, {"name": "stepDefinition-name", "value": "AssignMessage.Mirror.RequestID"}, {"name": "stepDefinition-enabled", "value": "true"}]}, "timestamp": "03-11-21 16:50:07:016"}, {"ActionResult": "ResponseMessage", "content": "{\"sub\":\"423dff67-e085-4b04-847f-490156bc7693\"}", "headers": [{"name": "Cache-Control", "value": "no-cache"}, {"name": "Connection", "value": "keep-alive"}, {"name": "Content-Length", "value": "46"}, {"name": "Content-Type", "value": "application/json"}, {"name": "Date", "value": "Wed, 03 Nov 2021 16:50:07 GMT"}, {"name": "Referrer-Policy", "value": "no-referrer"}, {"name": "Strict-Transport-Security", "value": "max-age=864000; includeSubDomains"}, {"name": "X-Content-Type-Options", "value": "nosniff"}, {"name": "X-Frame-Options", "value": "SAMEORIGIN"}, {"name": "X-XSS-Protection", "value": "1; mode=block"}], "reasonPhrase": "OK", "statusCode": "200"}, {"ActionResult": "VariableAccess", "accessList": [{"Get": {"name": "flag.custom-header-x-request-id"}}, {"Get": {"name": "original-request-details.header.X-Request-ID"}}]}]}, {"id": "Execution", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "action", "value": "CONTINUE"}, {"name": "stepDefinition-async", "value": "false"}, {"name": "internal", "value": "false"}, {"name": "stepDefinition-type", "value": "flowcallout"}, {"name": "expression", "value": "((apigee.access_token not equals null) and (apigee.access_token not equals \"\"))"}, {"name": "type", "value": "FlowCalloutStepExecution"}, {"name": "enforcement", "value": "request"}, {"name": "stepDefinition-continueOnError", "value": "false"}, {"name": "expressionResult", "value": "true"}, {"name": "stepDefinition-displayName", "value": "FlowCallout.HashAccessToken"}, {"name": "stepDefinition-name", "value": "FlowCallout.HashAccessToken"}, {"name": "stepDefinition-enabled", "value": "true"}, {"name": "result", "value": "true"}]}, "timestamp": "03-11-21 16:50:07:016"}, {"ActionResult": "ResponseMessage", "content": "{\"sub\":\"423dff67-e085-4b04-847f-490156bc7693\"}", "headers": [{"name": "Cache-Control", "value": "no-cache"}, {"name": "Connection", "value": "keep-alive"}, {"name": "Content-Length", "value": "46"}, {"name": "Content-Type", "value": "application/json"}, {"name": "Date", "value": "Wed, 03 Nov 2021 16:50:07 GMT"}, {"name": "Referrer-Policy", "value": "no-referrer"}, {"name": "Strict-Transport-Security", "value": "max-age=864000; includeSubDomains"}, {"name": "X-Content-Type-Options", "value": "nosniff"}, {"name": "X-Frame-Options", "value": "SAMEORIGIN"}, {"name": "X-XSS-Protection", "value": "1; mode=block"}], "reasonPhrase": "OK", "statusCode": "200"}, {"ActionResult": "VariableAccess", "accessList": [{"Set": {"name": "apigee.metrics.policy.FlowCallout.HashAccessToken.timeTaken", "success": true, "value": "4991"}}]}]}, {"id": "FlowCallout", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "shared.flow.name", "value": "HashAccessToken"}]}, "timestamp": "03-11-21 16:50:07:016"}]}, {"id": "Execution", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "action", "value": "CONTINUE"}, {"name": "stepDefinition-async", "value": "false"}, {"name": "internal", "value": "false"}, {"name": "stepDefinition-type", "value": "HMAC"}, {"name": "type", "value": "HMACStepExecution"}, {"name": "enforcement", "value": "request"}, {"name": "stepDefinition-continueOnError", "value": "false"}, {"name": "stepDefinition-displayName", "value": "HMAC.AccessToken"}, {"name": "stepDefinition-name", "value": "HMAC.AccessToken"}, {"name": "stepDefinition-enabled", "value": "true"}, {"name": "result", "value": "true"}]}, "timestamp": "03-11-21 16:50:07:016"}, {"ActionResult": "ResponseMessage", "content": "{\"sub\":\"423dff67-e085-4b04-847f-490156bc7693\"}", "headers": [{"name": "Cache-Control", "value": "no-cache"}, {"name": "Connection", "value": "keep-alive"}, {"name": "Content-Length", "value": "46"}, {"name": "Content-Type", "value": "application/json"}, {"name": "Date", "value": "Wed, 03 Nov 2021 16:50:07 GMT"}, {"name": "Referrer-Policy", "value": "no-referrer"}, {"name": "Strict-Transport-Security", "value": "max-age=864000; includeSubDomains"}, {"name": "X-Content-Type-Options", "value": "nosniff"}, {"name": "X-Frame-Options", "value": "SAMEORIGIN"}, {"name": "X-XSS-Protection", "value": "1; mode=block"}], "reasonPhrase": "OK", "statusCode": "200"}, {"ActionResult": "VariableAccess", "accessList": [{"Get": {"name": "apigee.access_token", "value": "dQom5uWPEllqzyAMQyAzL8xLcOAV"}}, {"Set": {"name": "hmac.HMAC.AccessToken.message", "success": true, "value": "dQom5uWPEllqzyAMQyAzL8xLcOAV"}}, {"Set": {"name": "hmac.HMAC.AccessToken.keybytes", "success": true, "value": "4241364246423933353838413838453539434539434334464341443846"}}, {"Set": {"name": "hmac.HMAC.AccessToken.outputencoding", "success": true, "value": "BASE64"}}, {"Set": {"name": "auth.access_token_hash", "success": true, "value": "CWIpYrKcxoBIEZtJVjQB7653xmW03PRUaFPyNbV0btr3sYBAfj6xJPiCI90Rl9A91I8hd0YBf+FAv1WcOow+NQ=="}}, {"Set": {"name": "apigee.metrics.policy.HMAC.AccessToken.timeTaken", "success": true, "value": "55435"}}]}]}, {"id": "FlowReturn", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "shared.flow.name", "value": "HashAccessToken"}]}, "timestamp": "03-11-21 16:50:07:016"}]}, {"id": "Execution", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "action", "value": "CONTINUE"}, {"name": "stepDefinition-async", "value": "false"}, {"name": "internal", "value": "false"}, {"name": "stepDefinition-type", "value": "flowcallout"}, {"name": "type", "value": "FlowCalloutStepExecution"}, {"name": "enforcement", "value": "request"}, {"name": "stepDefinition-continueOnError", "value": "false"}, {"name": "stepDefinition-displayName", "value": "FlowCallout.LogApiKeyProtectedEndpoints"}, {"name": "stepDefinition-name", "value": "FlowCallout.LogApiKeyProtectedEndpoints"}, {"name": "stepDefinition-enabled", "value": "true"}, {"name": "result", "value": "true"}]}, "timestamp": "03-11-21 16:50:07:016"}, {"ActionResult": "ResponseMessage", "content": "{\"sub\":\"423dff67-e085-4b04-847f-490156bc7693\"}", "headers": [{"name": "Cache-Control", "value": "no-cache"}, {"name": "Connection", "value": "keep-alive"}, {"name": "Content-Length", "value": "46"}, {"name": "Content-Type", "value": "application/json"}, {"name": "Date", "value": "Wed, 03 Nov 2021 16:50:07 GMT"}, {"name": "Referrer-Policy", "value": "no-referrer"}, {"name": "Strict-Transport-Security", "value": "max-age=864000; includeSubDomains"}, {"name": "X-Content-Type-Options", "value": "nosniff"}, {"name": "X-Frame-Options", "value": "SAMEORIGIN"}, {"name": "X-XSS-Protection", "value": "1; mode=block"}], "reasonPhrase": "OK", "statusCode": "200"}, {"ActionResult": "VariableAccess", "accessList": [{"Set": {"name": "apigee.metrics.policy.FlowCallout.LogApiKeyProtectedEndpoints.timeTaken", "success": true, "value": "3010"}}]}]}, {"id": "FlowCallout", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "shared.flow.name", "value": "LogApiKeyProtectedEndpoints"}]}, "timestamp": "03-11-21 16:50:07:016"}]}, {"id": "Paused", "results": []}, {"id": "Execution", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "javascript-executionTime", "value": "0"}, {"name": "action", "value": "CONTINUE"}, {"name": "javascript-timeLimit", "value": "200"}, {"name": "stepDefinition-async", "value": "false"}, {"name": "internal", "value": "false"}, {"name": "stepDefinition-type", "value": "javascript"}, {"name": "javascript-name", "value": "SetLoggingFields.js"}, {"name": "stepExecution-stdout", "value": "accept\naccept-encoding\nauthorization\nhost\nnhsd-correlation-id\nnhsd-request-id\nuser-agent\nx-forwarded-for\nx-forwarded-port\nx-forwarded-proto"}, {"name": "type", "value": "JavascriptStepExecution"}, {"name": "enforcement", "value": "request"}, {"name": "stepDefinition-continueOnError", "value": "false"}, {"name": "stepDefinition-displayName", "value": "JavaScript.SetLoggingFields"}, {"name": "stepDefinition-name", "value": "JavaScript.SetLoggingFields"}, {"name": "stepDefinition-enabled", "value": "true"}, {"name": "result", "value": "true"}]}, "timestamp": "03-11-21 16:50:07:017"}, {"ActionResult": "ResponseMessage", "content": "{\"sub\":\"423dff67-e085-4b04-847f-490156bc7693\"}", "headers": [{"name": "Cache-Control", "value": "no-cache"}, {"name": "Connection", "value": "keep-alive"}, {"name": "Content-Length", "value": "46"}, {"name": "Content-Type", "value": "application/json"}, {"name": "Date", "value": "Wed, 03 Nov 2021 16:50:07 GMT"}, {"name": "Referrer-Policy", "value": "no-referrer"}, {"name": "Strict-Transport-Security", "value": "max-age=864000; includeSubDomains"}, {"name": "X-Content-Type-Options", "value": "nosniff"}, {"name": "X-Frame-Options", "value": "SAMEORIGIN"}, {"name": "X-XSS-Protection", "value": "1; mode=block"}], "reasonPhrase": "OK", "statusCode": "200"}, {"ActionResult": "VariableAccess", "accessList": [{"Get": {"name": "apigee.client_id", "value": "2wv2G3YK2RPFucAQUA9yxlvo0qtlBr7s"}}, {"Get": {"name": "message.status.code", "value": "200"}}, {"Get": {"name": "apigee.developer.app.name", "value": "apim-auto-c7023f90-2533-499e-b73b-edd2d3d24ec8"}}, {"Get": {"name": "accesstoken.auth_grant_type", "value": "authorization_code"}}, {"Get": {"name": "request.headers.names", "value": "[Accept, Accept-Encoding, Authorization, Host, NHSD-Correlation-ID, NHSD-Request-ID, User-Agent, X-Forwarded-For, X-Forwarded-Port, X-Forwarded-Proto]"}}, {"Set": {"name": "apigee.metrics.policy.JavaScript.SetLoggingFields.timeTaken", "success": true, "value": "366302"}}]}]}, {"id": "Resumed", "results": []}, {"id": "FlowReturn", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "shared.flow.name", "value": "LogApiKeyProtectedEndpoints"}]}, "timestamp": "03-11-21 16:50:07:017"}]}, {"id": "FlowReturn", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "shared.flow.name", "value": "PostProxyFlowHook->PostProxySharedFlow"}]}, "timestamp": "03-11-21 16:50:07:017"}]}, {"id": "Condition", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "ExpressionResult", "value": "true"}, {"name": "Expression", "value": "(\"default\" equals proxy.name)"}, {"name": "Tree", "value": "PROXY_default"}]}, "timestamp": "03-11-21 16:50:07:017"}, {"ActionResult": "VariableAccess", "accessList": [{"Set": {"name": "apigee.edge.sharedflow.name", "success": true}}, {"Set": {"name": "apigee.edge.flowhook.name", "success": true}}, {"Get": {"name": "proxy.name", "value": "default"}}]}]}, {"id": "Condition", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "ExpressionResult", "value": "true"}, {"name": "Expression", "value": "(\"identity-server-userinfo\" equals target.name)"}, {"name": "Tree", "value": "TARGET_identity-server-userinfo"}]}, "timestamp": "03-11-21 16:50:07:017"}, {"ActionResult": "VariableAccess", "accessList": [{"Get": {"name": "target.name", "value": "identity-server-userinfo"}}]}]}, {"id": "StateChange", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "To", "value": "END"}, {"name": "From", "value": "RESP_SENT"}]}, "timestamp": "03-11-21 16:50:07:017"}, {"ActionResult": "ResponseMessage", "content": "{\"sub\":\"423dff67-e085-4b04-847f-490156bc7693\"}", "headers": [{"name": "Cache-Control", "value": "no-cache"}, {"name": "Connection", "value": "keep-alive"}, {"name": "Content-Length", "value": "46"}, {"name": "Content-Type", "value": "application/json"}, {"name": "Date", "value": "Wed, 03 Nov 2021 16:50:07 GMT"}, {"name": "Referrer-Policy", "value": "no-referrer"}, {"name": "Strict-Transport-Security", "value": "max-age=864000; includeSubDomains"}, {"name": "X-Content-Type-Options", "value": "nosniff"}, {"name": "X-Frame-Options", "value": "SAMEORIGIN"}, {"name": "X-XSS-Protection", "value": "1; mode=block"}], "reasonPhrase": "OK", "statusCode": "200"}]}, {"id": "DebugMask", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "SuccessFullyMaskedConfigs", "value": "[]"}]}, "timestamp": "03-11-21 16:50:07:017"}]}, {"id": "Resumed", "results": []}, {"id": "StateChange", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "To", "value": "PROXY_POST_RESP_SENT"}, {"name": "From", "value": "END"}]}, "timestamp": "03-11-21 16:50:07:017"}, {"ActionResult": "ResponseMessage", "content": "{\"sub\":\"423dff67-e085-4b04-847f-490156bc7693\"}", "headers": [{"name": "Cache-Control", "value": "no-cache"}, {"name": "Content-Length", "value": "46"}, {"name": "Content-Type", "value": "application/json"}, {"name": "Date", "value": "Wed, 03 Nov 2021 16:50:07 GMT"}, {"name": "Referrer-Policy", "value": "no-referrer"}, {"name": "Strict-Transport-Security", "value": "max-age=864000; includeSubDomains"}, {"name": "X-Apigee.dp.color", "value": "mp-564-210308-0060114-latest-cf6a"}, {"name": "X-Apigee.Message-ID", "value": "rrt-4658976038220403375-a-geu2-24021-103322-1"}, {"name": "X-Apigee.nat", "value": "prod-geu2b-gnat001"}, {"name": "X-Apigee.proxy", "value": "/organizations/nhsd-nonprod/environments/internal-dev/apiproxies/identity-service-pr-251/revisions/13"}, {"name": "X-Apigee.proxy.basepath", "value": "oauth2-pr-251"}, {"name": "X-Apigee.region", "value": "europe-west2"}, {"name": "X-Apigee.target-latency", "value": "23"}, {"name": "X-Content-Type-Options", "value": "nosniff"}, {"name": "X-Frame-Options", "value": "SAMEORIGIN"}, {"name": "X-XSS-Protection", "value": "1; mode=block"}], "reasonPhrase": "OK", "statusCode": "200"}]}, {"id": "Condition", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "ExpressionResult", "value": "true"}, {"name": "Expression", "value": "(\"default\" equals proxy.name)"}, {"name": "Tree", "value": "PROXY_default"}]}, "timestamp": "03-11-21 16:50:07:017"}, {"ActionResult": "VariableAccess", "accessList": [{"Get": {"name": "proxy.name", "value": "default"}}]}]}, {"id": "FlowInfo", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "proxy.flow.name", "value": "PostClientFlow"}]}, "timestamp": "03-11-21 16:50:07:017"}]}, {"id": "FlowInfo", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "current.flow.name", "value": "PostClientFlow"}]}, "timestamp": "03-11-21 16:50:07:017"}]}, {"id": "Execution", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "action", "value": "CONTINUE"}, {"name": "stepDefinition-async", "value": "false"}, {"name": "internal", "value": "false"}, {"name": "stepDefinition-type", "value": "flowcallout"}, {"name": "type", "value": "StepExecution"}, {"name": "enforcement", "value": "request"}, {"name": "stepDefinition-continueOnError", "value": "false"}, {"name": "stepDefinition-displayName", "value": "FlowCallout.LogToSplunk"}, {"name": "stepDefinition-name", "value": "FlowCallout.LogToSplunk"}, {"name": "stepDefinition-enabled", "value": "true"}, {"name": "result", "value": "true"}]}, "timestamp": "03-11-21 16:50:07:017"}, {"ActionResult": "ResponseMessage", "content": "{\"sub\":\"423dff67-e085-4b04-847f-490156bc7693\"}", "headers": [{"name": "Cache-Control", "value": "no-cache"}, {"name": "Content-Length", "value": "46"}, {"name": "Content-Type", "value": "application/json"}, {"name": "Date", "value": "Wed, 03 Nov 2021 16:50:07 GMT"}, {"name": "Referrer-Policy", "value": "no-referrer"}, {"name": "Strict-Transport-Security", "value": "max-age=864000; includeSubDomains"}, {"name": "X-Apigee.dp.color", "value": "mp-564-210308-0060114-latest-cf6a"}, {"name": "X-Apigee.Message-ID", "value": "rrt-4658976038220403375-a-geu2-24021-103322-1"}, {"name": "X-Apigee.nat", "value": "prod-geu2b-gnat001"}, {"name": "X-Apigee.proxy", "value": "/organizations/nhsd-nonprod/environments/internal-dev/apiproxies/identity-service-pr-251/revisions/13"}, {"name": "X-Apigee.proxy.basepath", "value": "oauth2-pr-251"}, {"name": "X-Apigee.region", "value": "europe-west2"}, {"name": "X-Apigee.target-latency", "value": "23"}, {"name": "X-Content-Type-Options", "value": "nosniff"}, {"name": "X-Frame-Options", "value": "SAMEORIGIN"}, {"name": "X-XSS-Protection", "value": "1; mode=block"}], "reasonPhrase": "OK", "statusCode": "200"}, {"ActionResult": "VariableAccess", "accessList": [{"Set": {"name": "apigee.metrics.policy.FlowCallout.LogToSplunk.timeTaken", "success": true, "value": "7986"}}]}]}, {"id": "FlowCallout", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "shared.flow.name", "value": "LogToSplunk"}]}, "timestamp": "03-11-21 16:50:07:018"}]}, {"id": "FlowInfo", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "ServiceCallout.request", "value": "{\"messageID\":\"rrt-4658976038220403375-a-geu2-24021-103322-1\",\"client\":{\"ip\":\"3.11.106.35\",\"received_start\":\"1635958206976\",\"received_end\":\"1635958206976\",\"sent_start\":\"1635958207017\",\"sent_end\":\"1635958207017\",\"user_agent\":\"Python/3.9 aiohttp/3.7.4.post0\"},\"request\":{\"uri\":\"/oauth2-pr-251/userinfo\",\"verb\":\"GET\",\"content_type\":\"\",\"content_length\":\"0\",\"content_encoding\":\"\",\"requestID\":\"\",\"correlationID\":\"\",\"host\":\"internal-dev.api.service.nhs.uk\",\"port\":\"443\",\"uri_path\":\"/oauth2-pr-251/userinfo\",\"....."}]}, "timestamp": "03-11-21 16:50:07:018"}]}, {"id": "Execution", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "action", "value": "CONTINUE"}, {"name": "stepDefinition-async", "value": "false"}, {"name": "internal", "value": "false"}, {"name": "stepDefinition-type", "value": "servicecallout"}, {"name": "type", "value": "StepExecution"}, {"name": "enforcement", "value": "request"}, {"name": "stepDefinition-continueOnError", "value": "false"}, {"name": "stepDefinition-displayName", "value": "ServiceCallout.LogToSplunk"}, {"name": "stepDefinition-name", "value": "ServiceCallout.LogToSplunk"}, {"name": "stepDefinition-enabled", "value": "true"}, {"name": "result", "value": "true"}]}, "timestamp": "03-11-21 16:50:07:018"}, {"ActionResult": "ResponseMessage", "content": "{\"sub\":\"423dff67-e085-4b04-847f-490156bc7693\"}", "headers": [{"name": "Cache-Control", "value": "no-cache"}, {"name": "Content-Length", "value": "46"}, {"name": "Content-Type", "value": "application/json"}, {"name": "Date", "value": "Wed, 03 Nov 2021 16:50:07 GMT"}, {"name": "Referrer-Policy", "value": "no-referrer"}, {"name": "Strict-Transport-Security", "value": "max-age=864000; includeSubDomains"}, {"name": "X-Apigee.dp.color", "value": "mp-564-210308-0060114-latest-cf6a"}, {"name": "X-Apigee.Message-ID", "value": "rrt-4658976038220403375-a-geu2-24021-103322-1"}, {"name": "X-Apigee.nat", "value": "prod-geu2b-gnat001"}, {"name": "X-Apigee.proxy", "value": "/organizations/nhsd-nonprod/environments/internal-dev/apiproxies/identity-service-pr-251/revisions/13"}, {"name": "X-Apigee.proxy.basepath", "value": "oauth2-pr-251"}, {"name": "X-Apigee.region", "value": "europe-west2"}, {"name": "X-Apigee.target-latency", "value": "23"}, {"name": "X-Content-Type-Options", "value": "nosniff"}, {"name": "X-Frame-Options", "value": "SAMEORIGIN"}, {"name": "X-XSS-Protection", "value": "1; mode=block"}], "reasonPhrase": "OK", "statusCode": "200"}, {"ActionResult": "VariableAccess", "accessList": [{"Get": {"name": "splunkCalloutRequest"}}, {"Set": {"name": "splunkCalloutRequest.header.Authorization", "success": true, "value": "Splunk 212c99be-0bfb-41cd-b19b-fc50385f2f35"}}, {"Set": {"name": "splunkCalloutRequest.verb", "success": true, "value": "POST"}}, {"Set": {"name": "splunkCalloutRequest.queryparam.index", "success": true, "value": "requests_apm_ptl"}}, {"Get": {"name": "virtualhost.name", "value": "secure"}}, {"Set": {"name": "splunkCalloutRequest.queryparam.host", "success": true, "value": "apigee:secure"}}, {"Get": {"name": "client.received.start.timestamp", "value": "1635958206976"}}, {"Set": {"name": "splunkCalloutRequest.queryparam.time", "success": true, "value": "1635958206976"}}, {"Set": {"name": "splunkCalloutRequest.queryparam.sourcetype", "success": true, "value": "apm-apigee-json"}}, {"Get": {"name": "organization.name", "value": "nhsd-nonprod"}}, {"Get": {"name": "environment.name", "value": "internal-dev"}}, {"Get": {"name": "apiproxy.name", "value": "identity-service-pr-251"}}, {"Get": {"name": "apiproxy.revision", "value": "13"}}, {"Set": {"name": "splunkCalloutRequest.queryparam.source", "success": true, "value": "apigee:nhsd-nonprod:internal-dev:identity-service-pr-251:13"}}, {"Get": {"name": "messageid", "value": "rrt-4658976038220403375-a-geu2-24021-103322-1"}}, {"Get": {"name": "client.ip", "value": "3.11.106.35"}}, {"Get": {"name": "client.received.start.timestamp", "value": "1635958206976"}}, {"Get": {"name": "client.received.end.timestamp", "value": "1635958206976"}}, {"Get": {"name": "client.sent.start.timestamp", "value": "1635958207017"}}, {"Get": {"name": "client.sent.end.timestamp", "value": "1635958207017"}}, {"Get": {"name": "request-data-for-splunk.header.User-Agent", "value": "Python/3.9 aiohttp/3.7.4.post0"}}, {"Get": {"name": "request-data-for-splunk.uri", "value": "/oauth2-pr-251/userinfo"}}, {"Get": {"name": "request-data-for-splunk.verb", "value": "GET"}}, {"Get": {"name": "request-data-for-splunk.header.Content-Type", "value": ""}}, {"Get": {"name": "client.received.content.length", "value": "0"}}, {"Get": {"name": "request-data-for-splunk.header.Content-Encoding"}}, {"Get": {"name": "request-data-for-splunk.header.X-Request-ID"}}, {"Get": {"name": "request-data-for-splunk.header.X-Correlation-ID"}}, {"Get": {"name": "request-data-for-splunk.header.Host", "value": "internal-dev.api.service.nhs.uk"}}, {"Get": {"name": "request-data-for-splunk.header.X-Forwarded-Port", "value": "443"}}, {"Get": {"name": "request-data-for-splunk.path", "value": "/oauth2-pr-251/userinfo"}}, {"Get": {"name": "request-data-for-splunk.querystring", "value": ""}}, {"Get": {"name": "organization.name", "value": "nhsd-nonprod"}}, {"Get": {"name": "apim.api_guid", "value": "d5a3f4fc-e61f-41f3-ab72-16aa5ef3ff2b"}}, {"Get": {"name": "apim.api_spec_guid", "value": ""}}, {"Get": {"name": "apigee.apiproduct.name", "value": "apim-auto-857ac0f7-291f-47f4-b7b0-25f78da5508c"}}, {"Get": {"name": "apigee.developer.app.name", "value": "apim-auto-c7023f90-2533-499e-b73b-edd2d3d24ec8"}}, {"Get": {"name": "environment.name", "value": "internal-dev"}}, {"Get": {"name": "apigee.client_id", "value": "2wv2G3YK2RPFucAQUA9yxlvo0qtlBr7s"}}, {"Get": {"name": "developer.app.id", "value": "dca12c22-082c-4d8f-9e5b-5a113e926d2c"}}, {"Get": {"name": "app.asid"}}, {"Get": {"name": "apiproxy.name", "value": "identity-service-pr-251"}}, {"Get": {"name": "apiproxy.revision", "value": "13"}}, {"Get": {"name": "proxy.basepath", "value": "oauth2-pr-251"}}, {"Get": {"name": "proxy.pathsuffix", "value": "/userinfo"}}, {"Get": {"name": "auth.access_token_hash", "value": "CWIpYrKcxoBIEZtJVjQB7653xmW03PRUaFPyNbV0btr3sYBAfj6xJPiCI90Rl9A91I8hd0YBf+FAv1WcOow+NQ=="}}, {"Get": {"name": "accesstoken.auth_user_id", "value": "423dff67-e085-4b04-847f-490156bc7693"}}, {"Get": {"name": "accesstoken.auth_type", "value": "user"}}, {"Get": {"name": "accesstoken.auth_grant_type", "value": "authorization_code"}}, {"Get": {"name": "accesstoken.auth_level", "value": "aal3"}}, {"Get": {"name": "accesstoken.auth_provider", "value": "nhs-cis2"}}, {"Get": {"name": "accesstoken.id_token-acr", "value": "AAL3_ANY"}}, {"Get": {"name": "grant_type", "value": "authorization_code"}}, {"Get": {"name": "status", "value": "approved"}}, {"Get": {"name": "accesstoken.id_token-subject", "value": "423dff67-e085-4b04-847f-490156bc7693"}}, {"Get": {"name": "accesstoken.id_token-issuer", "value": "https://identity.ptl.api.platform.nhs.uk/auth/realms/cis2-mock"}}, {"Get": {"name": "scope", "value": "urn:nhsd:apim:user-nhs-id:aal3:personal-demographics-service"}}, {"Get": {"name": "target.host", "value": "identity.ptl.api.platform.nhs.uk"}}, {"Get": {"name": "target.response.status.code", "value": "200"}}, {"Get": {"name": "target.received.content.length", "value": "46"}}, {"Get": {"name": "target.received.start.timestamp", "value": "1635958207015"}}, {"Get": {"name": "target.received.end.timestamp", "value": "1635958207016"}}, {"Get": {"name": "target.sent.start.timestamp", "value": "1635958206993"}}, {"Get": {"name": "target.sent.end.timestamp", "value": "1635958207008"}}, {"Get": {"name": "target.port", "value": "443"}}, {"Get": {"name": "is.error", "value": "false"}}, {"Get": {"name": "apigee.edge.execution.is_policy_error", "value": "0"}}, {"Get": {"name": "apigee.edge.execution.is_target_error", "value": "0"}}, {"Get": {"name": "apigee.edge.execution.fault_policy_name"}}, {"Get": {"name": "apigee.edge.execution.fault_flow_name"}}, {"Get": {"name": "error"}}, {"Get": {"name": "error.content"}}, {"Get": {"name": "error.message"}}, {"Get": {"name": "error.status.code"}}, {"Get": {"name": "error.reason.phrase"}}, {"Get": {"name": "error.transport.message"}}, {"Get": {"name": "error.state"}}, {"Get": {"name": "response.status.code", "value": "200"}}, {"Get": {"name": "response.header.Content-Type", "value": "application/json"}}, {"Get": {"name": "response.header.Content-Length", "value": "46"}}, {"Get": {"name": "response.header.Content-Encoding"}}, {"Get": {"name": "status.response"}}, {"Set": {"name": "splunkCalloutRequest.content", "success": true, "value": "{\"messageID\":\"rrt-4658976038220403375-a-geu2-24021-103322-1\",\"client\":{\"ip\":\"3.11.106.35\",\"received_start\":\"1635958206976\",\"received_end\":\"1635958206976\",\"sent_start\":\"1635958207017\",\"sent_end\":\"1635958207017\",\"user_agent\":\"Python/3.9 aiohttp/3.7.4.post0\"},\"request\":{\"uri\":\"/oauth2-pr-251/userinfo\",\"verb\":\"GET\",\"content_type\":\"\",\"content_length\":\"0\",\"content_encoding\":\"\",\"requestID\":\"\",\"correlationID\":\"\",\"host\":\"internal-dev.api.service.nhs.uk\",\"port\":\"443\",\"uri_path\":\"/oauth2-pr-251/userinfo\",\"uri_params\":\"\"},\"meta\":{\"organization\":\"nhsd-nonprod\",\"api_guid\":\"d5a3f4fc-e61f-41f3-ab72-16aa5ef3ff2b\",\"api_spec_guid\":\"\",\"product\":\"apim-auto-857ac0f7-291f-47f4-b7b0-25f78da5508c\",\"application\":\"apim-auto-c7023f90-2533-499e-b73b-edd2d3d24ec8\",\"env\":\"internal-dev\",\"client_id\":\"2wv2G3YK2RPFucAQUA9yxlvo0qtlBr7s\",\"application_id\":\"dca12c22-082c-4d8f-9e5b-5a113e926d2c\",\"ASID\":\"\"},\"proxy\":{\"name\":\"identity-service-pr-251\",\"revision\":\"13\",\"basepath\":\"oauth2-pr-251\",\"suffix\":\"/userinfo\"},\"auth\":{\"access_token_hash\":\"CWIpYrKcxoBIEZtJVjQB7653xmW03PRUaFPyNbV0btr3sYBAfj6xJPiCI90Rl9A91I8hd0YBf+FAv1WcOow+NQ==\",\"user\":{\"user_id\":\"423dff67-e085-4b04-847f-490156bc7693\"},\"meta\":{\"auth_type\":\"user\",\"grant_type\":\"authorization_code\",\"level\":\"aal3\",\"provider\":\"nhs-cis2\"},\"id_token_acr\":\"AAL3_ANY\",\"grant_type\":\"authorization_code\",\"authorization\":\"approved\",\"id_token_subject\":\"423dff67-e085-4b04-847f-490156bc7693\",\"id_token_issuer\":\"https://identity.ptl.api.platform.nhs.uk/auth/realms/cis2-mock\",\"scope\":\"urn:nhsd:apim:user-nhs-id:aal3:personal-demographics-service\"},\"target\":{\"host\":\"identity.ptl.api.platform.nhs.uk\",\"status_code\":\"200\",\"content_length\":\"46\",\"received_start\":\"1635958207015\",\"received_end\":\"1635958207016\",\"sent_start\":\"1635958206993\",\"sent_end\":\"1635958207008\",\"port\":\"443\"},\"error\":{\"is_error\":\"false\",\"is_policy_error\":\"0\",\"is_target_error\":\"0\",\"policy_error_policy_name\":\"\",\"policy_error_flow_name\":\"\",\"error\":\"\",\"content\":\"\",\"message\":\"\",\"status_code\":\"\",\"reason_phrase\":\"\",\"transport_message\":\"\",\"state\":\"\"},\"response\":{\"status_code\":\"200\",\"content_type\":\"application/json\",\"content_length\":\"46\",\"content_encoding\":\"\",\"content_body\":\"\"}}"}}, {"Set": {"name": "splunkCalloutRequest.header.Content-Type", "success": true, "value": "application/json"}}, {"Get": {"name": "splunkCalloutRequest"}}, {"Set": {"name": "servicecallout.requesturi", "success": true, "value": "/services/collector/raw?index=requests_apm_ptl&host=apigee%3Asecure&time=1635958206976&sourcetype=apm-apigee-json&source=apigee%3Anhsd-nonprod%3Ainternal-dev%3Aidentity-service-pr-251%3A13"}}, {"Set": {"name": "apigee.metrics.policy.ServiceCallout.LogToSplunk.timeTaken", "success": true, "value": "320559"}}]}]}, {"id": "FlowReturn", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "shared.flow.name", "value": "LogToSplunk"}]}, "timestamp": "03-11-21 16:50:07:018"}]}, {"id": "Paused", "results": []}, {"id": "FlowInfo", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "loadbalancing.targetserver", "value": "splunk-cloud-hec"}, {"name": "loadbalancing.isfallback", "value": "false"}, {"name": "loadbalancing.failedservers", "value": "[]"}]}, "timestamp": "03-11-21 16:50:07:018"}]}, {"id": "FlowInfo", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "servicecallout_ServiceCallout.LogToSplunk.totalConnectionTimeMs", "value": "0"}, {"name": "servicecallout_ServiceCallout.LogToSplunk.isTlsEnabled", "value": "true"}, {"name": "servicecallout_ServiceCallout.LogToSplunk.isFromClientPool", "value": "true"}, {"name": "servicecallout_ServiceCallout.LogToSplunk.socketUseCount", "value": "133"}, {"name": "servicecallout_ServiceCallout.LogToSplunk.socketAgeMs", "value": "519228"}, {"name": "servicecallout_ServiceCallout.LogToSplunk.resolvedAddress", "value": "3.11.152.88"}, {"name": "servicecallout_ServiceCallout.LogToSplunk.isHttpClientCached", "value": "true"}, {"name": "servicecallout_ServiceCallout.LogToSplunk.connectionTlsHandshakeTimeMs", "value": "0"}, {"name": "servicecallout_ServiceCallout.LogToSplunk.connectionStatus", "value": "CONNECTED"}]}, "timestamp": "03-11-21 16:50:07:018"}]}, {"id": "Execution", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "expressionResult", "value": "true"}, {"name": "type", "value": "AnalyticsPredefinedVariablesPublisher"}, {"name": "expression", "value": "(analytics equals null )"}]}, "timestamp": "03-11-21 16:50:07:018"}, {"ActionResult": "ResponseMessage", "content": "{\"sub\":\"423dff67-e085-4b04-847f-490156bc7693\"}", "headers": [{"name": "Cache-Control", "value": "no-cache"}, {"name": "Content-Length", "value": "46"}, {"name": "Content-Type", "value": "application/json"}, {"name": "Date", "value": "Wed, 03 Nov 2021 16:50:07 GMT"}, {"name": "Referrer-Policy", "value": "no-referrer"}, {"name": "Strict-Transport-Security", "value": "max-age=864000; includeSubDomains"}, {"name": "X-Apigee.dp.color", "value": "mp-564-210308-0060114-latest-cf6a"}, {"name": "X-Apigee.Message-ID", "value": "rrt-4658976038220403375-a-geu2-24021-103322-1"}, {"name": "X-Apigee.nat", "value": "prod-geu2b-gnat001"}, {"name": "X-Apigee.proxy", "value": "/organizations/nhsd-nonprod/environments/internal-dev/apiproxies/identity-service-pr-251/revisions/13"}, {"name": "X-Apigee.proxy.basepath", "value": "oauth2-pr-251"}, {"name": "X-Apigee.region", "value": "europe-west2"}, {"name": "X-Apigee.target-latency", "value": "23"}, {"name": "X-Content-Type-Options", "value": "nosniff"}, {"name": "X-Frame-Options", "value": "SAMEORIGIN"}, {"name": "X-XSS-Protection", "value": "1; mode=block"}], "reasonPhrase": "OK", "statusCode": "200"}, {"ActionResult": "VariableAccess", "accessList": []}]}, {"id": "Resumed", "results": []}, {"id": "Execution", "results": [{"ActionResult": "DebugInfo", "properties": {"property": [{"name": "expressionResult", "value": "false"}, {"name": "type", "value": "AnalyticsPublisher"}, {"name": "expression", "value": "(analytics not null)"}]}, "timestamp": "03-11-21 16:50:07:019"}, {"ActionResult": "ResponseMessage", "content": "{\"sub\":\"423dff67-e085-4b04-847f-490156bc7693\"}", "headers": [{"name": "Cache-Control", "value": "no-cache"}, {"name": "Content-Length", "value": "46"}, {"name": "Content-Type", "value": "application/json"}, {"name": "Date", "value": "Wed, 03 Nov 2021 16:50:07 GMT"}, {"name": "Referrer-Policy", "value": "no-referrer"}, {"name": "Strict-Transport-Security", "value": "max-age=864000; includeSubDomains"}, {"name": "X-Apigee.dp.color", "value": "mp-564-210308-0060114-latest-cf6a"}, {"name": "X-Apigee.Message-ID", "value": "rrt-4658976038220403375-a-geu2-24021-103322-1"}, {"name": "X-Apigee.nat", "value": "prod-geu2b-gnat001"}, {"name": "X-Apigee.proxy", "value": "/organizations/nhsd-nonprod/environments/internal-dev/apiproxies/identity-service-pr-251/revisions/13"}, {"name": "X-Apigee.proxy.basepath", "value": "oauth2-pr-251"}, {"name": "X-Apigee.region", "value": "europe-west2"}, {"name": "X-Apigee.target-latency", "value": "23"}, {"name": "X-Content-Type-Options", "value": "nosniff"}, {"name": "X-Frame-Options", "value": "SAMEORIGIN"}, {"name": "X-XSS-Protection", "value": "1; mode=block"}], "reasonPhrase": "OK", "statusCode": "200"}, {"ActionResult": "VariableAccess", "accessList": [{"Get": {"name": "envoy.proxy"}}, {"Get": {"name": "servicecallout.ServiceCallout.LogToSplunk.target.url"}}, {"Get": {"name": "envoy.proxy"}}, {"Get": {"name": "envoy.proxy"}}, {"Get": {"name": "servicecallout.ServiceCallout.LogToSplunk.expectedcn"}}, {"Get": {"name": "dynamic.target"}}, {"Get": {"name": "target.name", "value": "identity-server-userinfo"}}, {"Get": {"name": "dynamic.target"}}, {"Get": {"name": "target.basepath", "value": "{identity-service-config.cis2.userinfo_path}"}}, {"Get": {"name": "dynamic.target"}}, {"Get": {"name": "target.url"}}, {"Get": {"name": "target.host", "value": "identity.ptl.api.platform.nhs.uk"}}, {"Get": {"name": "target.ip", "value": "18.134.53.62"}}, {"Get": {"name": "client.ip", "value": "3.11.106.35"}}, {"Get": {"name": "is.error", "value": "false"}}, {"Get": {"name": "target.sent.start.timestamp", "value": "1635958206993"}}, {"Get": {"name": "target.sent.end.timestamp", "value": "1635958207008"}}, {"Get": {"name": "target.received.start.timestamp", "value": "1635958207015"}}, {"Get": {"name": "target.received.end.timestamp", "value": "1635958207016"}}, {"Get": {"name": "client.received.start.timestamp", "value": "1635958206976"}}, {"Get": {"name": "client.received.end.timestamp", "value": "1635958206976"}}, {"Get": {"name": "client.sent.start.timestamp", "value": "1635958207017"}}, {"Get": {"name": "client.sent.end.timestamp", "value": "1635958207017"}}, {"Get": {"name": "message.status.code", "value": "200"}}, {"Get": {"name": "request.uri", "value": "/auth/realms/cis2-mock/protocol/openid-connect/userinfo"}}, {"Get": {"name": "request.path", "value": "/auth/realms/cis2-mock/protocol/openid-connect/userinfo"}}, {"Get": {"name": "request.verb", "value": "GET"}}, {"Get": {"name": "flow.resource.name"}}, {"Get": {"name": "sla"}}, {"Get": {"name": "client.received.content.length", "value": "0"}}, {"Get": {"name": "target.received.content.length", "value": "46"}}, {"Get": {"name": "target.response.status.code", "value": "200"}}, {"Get": {"name": "request.header.User-Agent", "value": "Python/3.9 aiohttp/3.7.4.post0"}}, {"Get": {"name": "request.header.X-Apigee-Client-Device-Id"}}, {"Get": {"name": "request.header.X-Apigee-Client-Session-Id"}}, {"Get": {"name": "request.header.X-Apigee-Client-Org-Name"}}, {"Get": {"name": "request.header.X-Apigee-Client-App-Name"}}, {"Get": {"name": "request.header.X-Apigee-Client-Request-Id"}}, {"Get": {"name": "request.header.X-Forwarded-Proto", "value": "https"}}, {"Get": {"name": "request.header.True-client-ip"}}, {"Get": {"name": "analytics"}}]}]}, {"id": "Paused", "results": []}, {"id": "Resumed", "results": []}, {"id": "Paused", "results": []}]}
FAILED
Destroying Default App..


=================================== FAILURES ===================================
___________ TestBackChannelLogout.test_backchannel_logout_happy_path ___________

self = <e2e.tests.oauth.test_backchannel_logout.TestBackChannelLogout object at 0x7f547de6aac0>
test_app = <api_test_utils.apigee_api_apps.ApigeeApiDeveloperApps object at 0x7f547df31f70>
our_webdriver = <selenium.webdriver.remote.webdriver.WebDriver (session="05864976273709d74058e578f2993daa")>

    @pytest.mark.asyncio
    @pytest.mark.happy_path
    async def test_backchannel_logout_happy_path(self, test_app, our_webdriver):
        apigee_trace = ApigeeApiTraceDebug(proxy=config.SERVICE_NAME)
        await apigee_trace.start_trace()
        access_token = await self.get_access_token(our_webdriver)
    
        # Test token can be used to access identity service
        assert await self.call_user_info(test_app, access_token) == 200
        sleep(10)
        import json
        #get_sid_from_id_token(get_id_token_from_trace(await apigee_trace.get_trace_data()))
        print(json.dumps(await apigee_trace.get_trace_data()))
        # Mock back channel logout notification and test succesful logout response
        logout_token = create_logout_token(test_app)
    
        await apigee_trace.stop_trace()
    
        back_channel_resp = await test_app.oauth.hit_oauth_endpoint(
            method="POST",
            endpoint="backchannel_logout",
            data={"logout_token": logout_token}
        )
    
>       assert back_channel_resp['status_code'] == 200
E       assert 400 == 200
E         +400
E         -200

e2e/tests/oauth/test_backchannel_logout.py:231: AssertionError
=============================== warnings summary ===============================
tests/oauth/test_backchannel_logout.py::TestBackChannelLogout::test_backchannel_logout_happy_path
  /home/jf/Work/NHSDigital/identity-service-api/e2e/tests/oauth/test_backchannel_logout.py:37: DeprecationWarning: desired_capabilities has been deprecated, please pass in an Options object with options kwarg
    wd = webdriver.Remote(command_executor='http://127.0.0.1:4444/wd/hub', desired_capabilities=DesiredCapabilities.CHROME)

-- Docs: https://docs.pytest.org/en/stable/warnings.html
=========================== short test summary info ============================
FAILED e2e/tests/oauth/test_backchannel_logout.py::TestBackChannelLogout::test_backchannel_logout_happy_path
================= 1 failed, 11 deselected, 1 warning in 33.32s =================
