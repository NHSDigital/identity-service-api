parameters:
  - name: serviceName
    type: string
  - name: artifactBuildId
    type: string
  - name: artifactBranch
    type: string
  - name: pipelineAlias
    type: string

steps:
  - download: none
  - bash: echo "${{ parameters.artifactBuildId }}+${{ parameters.artifactBranch }} Source $(Build.SourceBranch)"
  - task: DownloadPipelineArtifact@2
    displayName: 'Download Build Artifact'
    inputs:
      source: 'specific'
      project: '$(resources.pipeline.${{ parameters.pipelineAlias }}.projectID)'
      definition: '$(resources.pipeline.${{ parameters.pipelineAlias }}.pipelineID)'
      preferTriggeringPipeline: true
      ${{ if eq(parameters.artifactBuildId, 'latest') }}:
        buildVersionToDownload: 'latestFromBranch'
      ${{ if ne(parameters.artifactBuildId, 'latest') }}:
        buildVersionToDownload: 'specific'
        runId: '${{ parameters.artifactBuildId }}'
      ${{ if eq(parameters.artifactBranch, '$(Build.SourceBranch)') }}:
        branchName: '$(Build.SourceBranch)'
      ${{ if ne(parameters.artifactBranch, '$(Build.SourceBranch)') }}:
        branchName: 'refs/heads/${{ parameters.artifactBranch }}'
      downloadPath: '$(Pipeline.Workspace)/${{ parameters.serviceName }}'